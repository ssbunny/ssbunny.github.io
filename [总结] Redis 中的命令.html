
    <!DOCTYPE html>
    <html>
    <head>
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <!-- common.css -->
      <style>* {-webkit-tap-highlight-color: rgba(0,0,0,0);}html {-webkit-text-size-adjust: none;}body {font-family: -apple-system, Helvetica, Arial, sans-serif;margin: 0;padding: 20px;color: #333;word-wrap: break-word;}h1, h2, h3, h4, h5, h6 {line-height: 1.1;}img {max-width: 100% !important;height: auto;}blockquote {margin: 0;padding: 0 15px;color: #777;border-left: 4px solid #ddd;}hr {background-color: #ddd;border: 0;height: 1px;margin: 15px 0;}code {font-family: Menlo, Consolas, 'Ubuntu Mono', Monaco, 'source-code-pro', monospace;line-height: 1.4;margin: 0;padding: 0.2em 0;font-size: 90%;background-color: rgba(0,0,0,0.04);border-radius: 3px;}pre > code {margin: 0;padding: 0;font-size: 100%;word-break: normal;background: transparent;border: 0;}ol {list-style-type: decimal;}ol ol, ul ol {list-style-type: lower-latin;}ol ol ol, ul ol ol, ul ul ol, ol ul ol {list-style-type: lower-roman;}table {border-spacing: 0;border-collapse: collapse;margin-top: 0;margin-bottom: 16px;}table th {font-weight: bold;}table th, table td {padding: 6px 13px;border: 1px solid #ddd;}table tr {border-top: 1px solid #ccc;}table tr:nth-child(even) {background-color: #f8f8f8;}input[type="checkbox"] {cursor: default;margin-right: 0.5em;font-size: 13px;}.task-list-item {list-style-type: none;}.task-list-item+.task-list-item {margin-top: 3px;}.task-list-item input {float: left;margin: 0.3em 1em 0.25em -1.6em;vertical-align: middle;}#tag-field {margin: 8px 2px 10px;}#tag-field .tag {display: inline-block;background: #cadff3;border-radius: 4px;padding: 1px 8px;color: black;font-size: 12px;margin-right: 10px;line-height: 1.4;}</style>
      <!-- ace-static.css -->
      <style>.ace_static_highlight {white-space: pre-wrap;}.ace_static_highlight .ace_gutter {width: 2em;text-align: right;padding: 0 3px 0 0;margin-right: 3px;}.ace_static_highlight.ace_show_gutter > .ace_line {padding-left: 2.6em;}.ace_static_highlight .ace_line {position: relative;}.ace_static_highlight .ace_gutter-cell {-moz-user-select: -moz-none;-khtml-user-select: none;-webkit-user-select: none;user-select: none;top: 0;bottom: 0;left: 0;position: absolute;}.ace_static_highlight .ace_gutter-cell:before {content: counter(ace_line, decimal);counter-increment: ace_line;}.ace_static_highlight {counter-reset: ace_line;}</style>
      <style>.ace-chrome .ace_gutter {background: #ebebeb;color: #333;overflow : hidden;}.ace-chrome .ace_print-margin {width: 1px;background: #e8e8e8;}.ace-chrome {background-color: #FFFFFF;color: black;}.ace-chrome .ace_cursor {color: black;}.ace-chrome .ace_invisible {color: rgb(191, 191, 191);}.ace-chrome .ace_constant.ace_buildin {color: rgb(88, 72, 246);}.ace-chrome .ace_constant.ace_language {color: rgb(88, 92, 246);}.ace-chrome .ace_constant.ace_library {color: rgb(6, 150, 14);}.ace-chrome .ace_invalid {background-color: rgb(153, 0, 0);color: white;}.ace-chrome .ace_fold {}.ace-chrome .ace_support.ace_function {color: rgb(60, 76, 114);}.ace-chrome .ace_support.ace_constant {color: rgb(6, 150, 14);}.ace-chrome .ace_support.ace_type,.ace-chrome .ace_support.ace_class.ace-chrome .ace_support.ace_other {color: rgb(109, 121, 222);}.ace-chrome .ace_variable.ace_parameter {font-style:italic;color:#FD971F;}.ace-chrome .ace_keyword.ace_operator {color: rgb(104, 118, 135);}.ace-chrome .ace_comment {color: #236e24;}.ace-chrome .ace_comment.ace_doc {color: #236e24;}.ace-chrome .ace_comment.ace_doc.ace_tag {color: #236e24;}.ace-chrome .ace_constant.ace_numeric {color: rgb(0, 0, 205);}.ace-chrome .ace_variable {color: rgb(49, 132, 149);}.ace-chrome .ace_xml-pe {color: rgb(104, 104, 91);}.ace-chrome .ace_entity.ace_name.ace_function {color: #0000A2;}.ace-chrome .ace_heading {color: rgb(12, 7, 255);}.ace-chrome .ace_list {color:rgb(185, 6, 144);}.ace-chrome .ace_marker-layer .ace_selection {background: rgb(181, 213, 255);}.ace-chrome .ace_marker-layer .ace_step {background: rgb(252, 255, 0);}.ace-chrome .ace_marker-layer .ace_stack {background: rgb(164, 229, 101);}.ace-chrome .ace_marker-layer .ace_bracket {margin: -1px 0 0 -1px;border: 1px solid rgb(192, 192, 192);}.ace-chrome .ace_marker-layer .ace_active-line {background: rgba(0, 0, 0, 0.07);}.ace-chrome .ace_gutter-active-line {background-color : #dcdcdc;}.ace-chrome .ace_marker-layer .ace_selected-word {background: rgb(250, 250, 255);border: 1px solid rgb(200, 200, 250);}.ace-chrome .ace_storage,.ace-chrome .ace_keyword,.ace-chrome .ace_meta.ace_tag {color: rgb(147, 15, 128);}.ace-chrome .ace_string.ace_regex {color: rgb(255, 0, 0)}.ace-chrome .ace_string {color: #1A1AA6;}.ace-chrome .ace_entity.ace_other.ace_attribute-name {color: #994409;}.ace-chrome .ace_indent-guide {background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAACCAYAAACZgbYnAAAAE0lEQVQImWP4////f4bLly//BwAmVgd1/w11/gAAAABJRU5ErkJggg==") right repeat-y;}</style>
      <!-- export.css -->
      <style>
        body{margin:0 auto;max-width:800px;line-height:1.4}
        #nav{margin:5px 0 10px;font-size:15px}
        #titlearea{border-bottom:1px solid #ccc;font-size:17px;padding:10px 0;}
        #contentarea{font-size:15px;margin:16px 0}
        .cell{outline:0;min-height:20px;margin:5px 0;padding:5px 0;}
        .code-cell{font-family:Menlo,Consolas,'Ubuntu Mono',Monaco,'source-code-pro',monospace;font-size:12px;}
        .latex-cell{white-space:pre-wrap;}
      </style>
      <!-- User CSS -->
      <style> .text-cell {font-size: 15px;}.code-cell {font-size: 12px;}.markdown-cell {font-size: 15px;}.latex-cell {font-size: 15px;}</style>
    </head>
    <body>
      <div id="nav"><div>Next: <a href='[总结] JavaScript 中高级知识整理.html'>[总结] JavaScript 中高级知识整理</a>, Previous: <a href='[总结] 关于 JavaScript 数字的那些事.html'>[总结] 关于 JavaScript 数字的那些事</a>, Up: <a href='index.html'>Index</a></div></div>
      <div id="titlearea">
        <h2>[总结] Redis 中的命令</h2>
      </div>
      <div id="contentarea"><div class="cell markdown-cell"><p>Redis 中有五种常用数据结构，它们都有对应的操作命令：</p>
<p><img src="resources/137EF8469E4CBCBEA2317255843EAB42.png" alt="redis.png" width="1178" height="513"></p>
<p><a href="http://redis.io/commands">[当前最新的所有命令]</a></p>
<h2>1. 字符串</h2>
<p>Redis 中 <code>STRINGs</code> 用来存储三种类型：</p>
<ul>
<li>字符串</li>
<li>整数</li>
<li>浮点数</li>
</ul>
<p>整数和浮点数可增减。<strong>整数</strong>范围为平台的长整型范围(如，64位系统中为有符号的64位整型)；<strong>浮点数</strong>采用 IEEE 754 双精度浮点数。</p>
<p><strong>增减命令</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left">命令</th>
<th style="text-align:left">示例及说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">INCR</td>
<td style="text-align:left"><code>INCR key-name</code> 将当前 key 对应的值加 1</td>
</tr>
<tr>
<td style="text-align:left">DECR</td>
<td style="text-align:left"><code>DECR key-name</code> 将当前 key 对应的值减 1</td>
</tr>
<tr>
<td style="text-align:left">INCRBY</td>
<td style="text-align:left"><code>INCRBY key-name amount</code> 将当前 key 对应的值加上指定的整数值</td>
</tr>
<tr>
<td style="text-align:left">DECRBY</td>
<td style="text-align:left"><code>DECRBY key-name amount</code> 将当前 key 对应的值减去指定的整数值</td>
</tr>
<tr>
<td style="text-align:left">INCRBYFLOAT</td>
<td style="text-align:left"><code>INCRBYFLOAT key-name amount</code> 将当前 key 对应的值加上指定的浮点值</td>
</tr>
</tbody>
</table>
<p>如果尝试在空字符串或不存在的 key 上调用 <code>INCR*</code> 或 <code>DECR*</code> ，当前 key 值会被当作 <code>0</code> 来处理：</p>
<p><img src="resources/792EC40D65671A2538C94E865939FD8E.png" alt="incr_empty.png" width="1116" height="340"></p>
<p>如果尝试在非整数或浮点数上调用 <code>INCR*</code> 或 <code>DECR*</code> ，会抛出 error ：</p>
<p><img src="resources/99CE7B7F9A2CBB7CD755675FBB05E0E7.png" alt="incr_error.png" width="1122" height="138"></p>
<p><strong>操纵字符串命令</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left">命令</th>
<th style="text-align:left">示例及说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">APPEND</td>
<td style="text-align:left"><code>APPEND key-name value</code> 拼接字符串 value 至指定 key 值</td>
</tr>
<tr>
<td style="text-align:left">GETRANGE</td>
<td style="text-align:left"><code>GETRANGE key-name start end</code> 截取从 start 到 end 的子串(闭区间)</td>
</tr>
<tr>
<td style="text-align:left">SETRANGE</td>
<td style="text-align:left"><code>SETRANGE key-name offset value</code> 从 offset 开始添加 value 子串</td>
</tr>
<tr>
<td style="text-align:left">GETBIT</td>
<td style="text-align:left"><code>GETBIT key-name offset</code> 获取 offset 处的 bit 值</td>
</tr>
<tr>
<td style="text-align:left">SETBIT</td>
<td style="text-align:left"><code>SETBIT key-name offset value</code> 设置 offset 处的 bit 值</td>
</tr>
<tr>
<td style="text-align:left">BITCOUNT</td>
<td style="text-align:left"><code>BITCOUNT key-name [start end]</code> 计算 string 占了多少位</td>
</tr>
<tr>
<td style="text-align:left">BITOP</td>
<td style="text-align:left"><code>BITOP operation dest-key key-name [key-name ...]</code> 位运算，结果存入 dest-key 中。 operation 包括 AND, OR, XOR, NOT</td>
</tr>
</tbody>
</table>
<p>使用示例：</p>
<p><img src="resources/D3C64C0A2B440D0FE29678322D0DD272.png" alt="setrange.png" width="1116" height="202"></p>
<h2>2. 列表</h2>
<p><code>LISTs</code> 中存储有序的 <code>STRING</code> 序列。</p>
<p><strong>基本命令</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left">命令</th>
<th style="text-align:left">示例及说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">RPUSH</td>
<td style="text-align:left"><code>RPUSH key-name value [value...]</code> 向 list 尾部(右)添加值</td>
</tr>
<tr>
<td style="text-align:left">LPUSH</td>
<td style="text-align:left"><code>LPUSH key-name value [value...]</code> 向 list 首部(左)添加值</td>
</tr>
<tr>
<td style="text-align:left">RPOP</td>
<td style="text-align:left"><code>RPOP key-name</code> 移除并返回最右侧的值</td>
</tr>
<tr>
<td style="text-align:left">LPOP</td>
<td style="text-align:left"><code>LPOP key-name</code> 移除并返回最左侧的值</td>
</tr>
<tr>
<td style="text-align:left">LINDEX</td>
<td style="text-align:left"><code>LINDEX key-name offset</code> 返回指定 offset 处的值</td>
</tr>
<tr>
<td style="text-align:left">LRANGE</td>
<td style="text-align:left"><code>LRANGE key-name start end</code> 返回从 start 到 end 处的值(闭区间)</td>
</tr>
<tr>
<td style="text-align:left">LTRIM</td>
<td style="text-align:left"><code>LTRIM key-name start end</code> 截取 list ，只保留从 start 到 end 的值</td>
</tr>
</tbody>
</table>
<p><strong>Blocking操作</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left">命令</th>
<th style="text-align:left">示例及说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">BLPOP</td>
<td style="text-align:left"><code>BLPOP key-name [key-name ...] timeout</code> 返回第一个非空列表中最左侧的值，或一直等待 timeout 秒。</td>
</tr>
<tr>
<td style="text-align:left">BRPOP</td>
<td style="text-align:left"><code>BRPOP key-name [key-name ...] timeout</code> 返回第一个非空列表中最右侧的值，或一直等待 timeout 秒。</td>
</tr>
<tr>
<td style="text-align:left">RPOPLPUSH</td>
<td style="text-align:left"><code>RPOPLPUSH source-key dest-key</code> 将 source 中最右侧的值放入 dest 的左侧，并返回该值。</td>
</tr>
<tr>
<td style="text-align:left">BRPOPLPUSH</td>
<td style="text-align:left"><code>BRPOPLPUSH source-key dest-key timeout</code> 将 source 中最右侧的值放入 dest 的左侧，并返回该值。如果 source 为空，一直等待 timeout 秒。</td>
</tr>
</tbody>
</table>
<p>以上命令在操作消息队列或任务队列时非常常用。使用示例：</p>
<p><img src="resources/38E887E369E1C5AC63FBE991C5F9949B.png" alt="brpop.png" width="1534" height="460"></p>
<p>当右侧的终端执行命令后，左侧输出上图结果，否则会一直等待 20 秒超时并返回 <code>nil</code> 。</p>
<h2>3. 集合</h2>
<p><code>SETs</code> 用来保存唯一、无序的项。</p>
<p><strong>基本命令</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left">命令</th>
<th style="text-align:left">示例及说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">SADD</td>
<td style="text-align:left"><code>SADD key-name item [item ...]</code> 添加条目并返回实际加入的数量</td>
</tr>
<tr>
<td style="text-align:left">SREM</td>
<td style="text-align:left"><code>SREM key-name item [item ...]</code> 删除条目并返回删除的数量</td>
</tr>
<tr>
<td style="text-align:left">SISMEMBER</td>
<td style="text-align:left"><code>SISMEMBER key-name item</code> 检测某条目是否在 set 中(0否1是)</td>
</tr>
<tr>
<td style="text-align:left">SCARD</td>
<td style="text-align:left"><code>SCARD key-name</code> 返回 set 中条目的总数</td>
</tr>
<tr>
<td style="text-align:left">SMEMBERS</td>
<td style="text-align:left"><code>SMEMBERS key-name</code> 返回所有条目</td>
</tr>
<tr>
<td style="text-align:left">SRANDMEMBER</td>
<td style="text-align:left"><code>SRANDMEMBER key-name [count]</code> 随机返回1个或多个条目</td>
</tr>
<tr>
<td style="text-align:left">SPOP</td>
<td style="text-align:left"><code>SPOP key-name</code> 随机删除并返回一个条目</td>
</tr>
<tr>
<td style="text-align:left">SMOVE</td>
<td style="text-align:left"><code>SMOVE source-key dest-key item</code> 如果条目存在，将其从 source 移至 dest</td>
</tr>
</tbody>
</table>
<p><strong>拼接、操纵命令</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left">命令</th>
<th style="text-align:left">示例及说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">SDIFF</td>
<td style="text-align:left"><code>SDIFF key-name [key-name ...]</code> 返回第一个 set 中的条目，该条目不在任何其它的 set 中</td>
</tr>
<tr>
<td style="text-align:left">SDIFFSTORE</td>
<td style="text-align:left"><code>SDIFFSTORE dest-key key-name [key-name ...]</code> 同上条命令，但将结果保存在 dest-key 中</td>
</tr>
<tr>
<td style="text-align:left">SINTER</td>
<td style="text-align:left"><code>SINTER key-name [key-name ...]</code> 返回指定 set 中条目的交集</td>
</tr>
<tr>
<td style="text-align:left">SINTERSTORE</td>
<td style="text-align:left"><code>SINTERSTORE dest-key key-name [key-name ...]</code> 返回指定 set 中条目的交集并保存在 dest-key 中</td>
</tr>
<tr>
<td style="text-align:left">SUNION</td>
<td style="text-align:left"><code>SUNION key-name [key-name ...]</code> 返回指定 set 中条目的并集</td>
</tr>
<tr>
<td style="text-align:left">SUNIONSTORE</td>
<td style="text-align:left"><code>SUNIONSTORE dest-key key-name [key-name ...]</code> 返回指定 set 中条目的并集并保存在 dest-key 中</td>
</tr>
</tbody>
</table>
<p>使用示例：</p>
<p><img src="resources/31006A9F5BAA82DBCD5B25A5ADBCD24D.png" alt="sdiff.png" width="1128" height="302"></p>
<h2>4. 哈希</h2>
<p><code>HASHes</code> 用来存储一组键值对。</p>
<p><strong>增加、删除命令</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left">命令</th>
<th style="text-align:left">示例及说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">HMGET</td>
<td style="text-align:left"><code>HMGET key-name key [key ...]</code> 获取指定 key 下的值</td>
</tr>
<tr>
<td style="text-align:left">HMSET</td>
<td style="text-align:left"><code>HMSET key-name key value [key value ...]</code> 给指定 key 设置值</td>
</tr>
<tr>
<td style="text-align:left">HDEL</td>
<td style="text-align:left"><code>HDEL key-name key [key ...]</code> 删除指定键值对</td>
</tr>
<tr>
<td style="text-align:left">HLEN</td>
<td style="text-align:left"><code>HLEN key-name</code> 获取键值对的总数</td>
</tr>
</tbody>
</table>
<p>使用示例：</p>
<p><img src="resources/1F8C9446CC0CE263A8CB023955AA73A6.png" alt="hash_common.png" width="1216" height="438"></p>
<p><strong>批量操作</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left">命令</th>
<th style="text-align:left">示例及说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">HEXISTS</td>
<td style="text-align:left"><code>HEXISTS key-name key</code> 检测 key 是否存在</td>
</tr>
<tr>
<td style="text-align:left">HKEYS</td>
<td style="text-align:left"><code>HKEYS key-name</code> 获取所有的 key</td>
</tr>
<tr>
<td style="text-align:left">HVALS</td>
<td style="text-align:left"><code>HVALS key-name</code> 获取所有的 value</td>
</tr>
<tr>
<td style="text-align:left">HGETALL</td>
<td style="text-align:left"><code>HGETALL key-name</code> 获取所有的 key-value</td>
</tr>
<tr>
<td style="text-align:left">HINCRBY</td>
<td style="text-align:left"><code>HINCRBY key-name key increment</code> 指定 key 对应的值增加整数 increment 值</td>
</tr>
<tr>
<td style="text-align:left">HINCRBYFLOAT</td>
<td style="text-align:left"><code>HINCRBYFLOAT key-name key increment</code> 指定 key 对应的值增加浮点数 increment 值</td>
</tr>
</tbody>
</table>
<h2>5. 有序集合</h2>
<p><code>ZSET</code> 存储一组成员条目到其得分的映射。成员或得分均可以作为获取或扫描条件。</p>
<p><strong>基本命令</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left">命令</th>
<th style="text-align:left">示例及说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">ZADD</td>
<td style="text-align:left"><code>ZADD key-name score member [score member ...]</code> 增加指定了分数的成员</td>
</tr>
<tr>
<td style="text-align:left">ZREM</td>
<td style="text-align:left"><code>ZREM key-name member [member ...]</code> 删除成员并返回删除的条数</td>
</tr>
<tr>
<td style="text-align:left">ZCARD</td>
<td style="text-align:left"><code>ZCARD key-name</code> 返回成员总数</td>
</tr>
<tr>
<td style="text-align:left">ZINCRBY</td>
<td style="text-align:left"><code>ZINCRBY key-name increment member</code> 增加指定成员的得分值</td>
</tr>
<tr>
<td style="text-align:left">ZCOUNT</td>
<td style="text-align:left"><code>ZCOUNT key-name min max</code> 获取 min 到 max 得分范围的成员数量</td>
</tr>
<tr>
<td style="text-align:left">ZRANK</td>
<td style="text-align:left"><code>ZRANK key-name member</code> 获取成员所在的下标索引</td>
</tr>
<tr>
<td style="text-align:left">ZSCORE</td>
<td style="text-align:left"><code>ZSCORE key-name member</code> 获取指定成员的得分</td>
</tr>
<tr>
<td style="text-align:left">ZRANGE</td>
<td style="text-align:left"><code>ZRANGE key-name start stop [WITHSCORES]</code> 获取 start 至 stop 间的成员(可选地获取对应得分)</td>
</tr>
</tbody>
</table>
<p><strong>获取、删除指定范围数据</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left">命令</th>
<th style="text-align:left">示例及说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">ZREVRANK</td>
<td style="text-align:left"><code>ZREVRANK key-name member</code> 对应 ZRANK 命令，返回成员的反序索引</td>
</tr>
<tr>
<td style="text-align:left">ZREVRANGE</td>
<td style="text-align:left"><code>ZREVRANGE key-name start stop [WITHSCORES]</code> 对应 ZRANGE，反序</td>
</tr>
<tr>
<td style="text-align:left">ZRANGEBYSCORE</td>
<td style="text-align:left"><code>ZRANGEBYSCORE key min max [WITHSCORES] [LIMIT offset count]</code> 根据得分范围获取成员</td>
</tr>
<tr>
<td style="text-align:left">ZREVRANGEBYSCORE</td>
<td style="text-align:left"><code>ZREVRANGEBYSCOREkey max min [WITHSCORES] [LIMIT offset count]</code> ZRANGEBYSCORE命令的反序结果</td>
</tr>
<tr>
<td style="text-align:left">ZREMRANGEBYRANK</td>
<td style="text-align:left"><code>ZREMRANGEBYRANK key-name start stop</code> 删除指定下标范围的成员</td>
</tr>
<tr>
<td style="text-align:left">ZREMRANGEBYSCORE</td>
<td style="text-align:left"><code>ZREMRANGEBYSCORE key-name min max</code> 删除指定得分范围的成员</td>
</tr>
<tr>
<td style="text-align:left">ZINTERSTORE</td>
<td style="text-align:left"><code>ZINTERSTORE dest-key numkeys key [key ...] [WEIGHTS weight [weight...]] [AGGREGATE (SUM or MIN or MAX)]</code> ZSET上的交集操作</td>
</tr>
<tr>
<td style="text-align:left">ZUNIONSTORE</td>
<td style="text-align:left"><code>ZUNIONSTORE dest-key numkeys key [key ...] [WEIGHTS weight [weight...]] [AGGREGATE (SUM or MIN or MAX)]</code> ZSET上的并集操作</td>
</tr>
</tbody>
</table>
<p>其中，<code>ZINTERSTORE</code> 和 <code>ZUNIONSTORE</code> 的参数 <code>numkeys</code> 表示后面将跟多少个集合作为入参。某些客户端实现(如python)可能省略该参数，因为它可以在函数内计算该值。</p>
<p><code>ZINTERSTORE</code> 使用示例：</p>
<p><img src="resources/F92752842190B6685BA99E6A7562C0E4.png" alt="zinterstore.png" width="1206" height="438"></p>
<p>其执行过程如下：</p>
<p><img src="resources/838EC2AB0F513CA9B579A734D2C11F59.png" alt="zinterstore_detail.png" width="1166" height="284"></p>
<p><code>ZUNIONSTORE</code> 使用示例：</p>
<p><img src="resources/461D2E79AF8937F2CB85E5781D80EBA1.png" alt="zunionstore.png" width="1274" height="368"></p>
<p>其执行过程如下：</p>
<p><img src="resources/3425C91D0CF155E3077D990D823B26A5.png" alt="zunionstore_detail.png" width="1164" height="316"></p>
<p>ZSET 和 SET 取交集示例：</p>
<p><img src="resources/BB01732A4E9A22A7A7837D67D3164620.png" alt="zunionstore_with_set.png" width="1240" height="438"></p>
<p>其执行过程如下：</p>
<p><img src="resources/CFDEF495A36B671AAD006590DCC51FD3.png" alt="zunionstore_with_set_detail.png" width="1312" height="298"></p>
<h2>6. 发布/订阅</h2>
<p>Redis 中实现了发布/订阅模式。</p>
<p><strong>基本命令</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left">命令</th>
<th style="text-align:left">示例及说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">SUBSCRIBE</td>
<td style="text-align:left"><code>SUBSCRIBE channel [channel ...]</code> 订阅指定的通道</td>
</tr>
<tr>
<td style="text-align:left">UNSUBSCRIBE</td>
<td style="text-align:left"><code>UNSUBSCRIBE [channel [channel ...]]</code> 取消订阅</td>
</tr>
<tr>
<td style="text-align:left">PUBLISH</td>
<td style="text-align:left"><code>PUBLISH channel message</code> 发布消息</td>
</tr>
<tr>
<td style="text-align:left">PSUBSCRIBE</td>
<td style="text-align:left"><code>PSUBSCRIBE pattern [pattern ...]</code> 订阅指定匹配模式的通道</td>
</tr>
<tr>
<td style="text-align:left">PUNSUBSCRIBE</td>
<td style="text-align:left"><code>PUNSUBSCRIBE [pattern [pattern ...]]</code> 取消订阅匹配模式的通道</td>
</tr>
</tbody>
</table>
<p>应减少使用 Redis 提供的此模式，存在两个问题：</p>
<ol>
<li>订阅者读消息的速度较慢，会导致 Redis 保存着大量的缓冲，继而导致其性能下降；</li>
<li>订阅者断开连接至重连成功之间发送的消息将会丢失。</li>
</ol>
<p>一个小例子：</p>
<pre><div class="ace-chrome"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_storage ace_type">var</span> <span class="ace_identifier">redis</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">require</span><span class="ace_paren ace_lparen">(</span><span class="ace_string">'redis'</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_storage ace_type">var</span> <span class="ace_identifier">lilei</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">redis</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">createClient</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_storage ace_type">var</span> <span class="ace_identifier">hanmeimei</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">redis</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">createClient</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_storage ace_type">var</span> <span class="ace_identifier">count</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_constant ace_numeric">0</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">lilei</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">on</span><span class="ace_paren ace_lparen">(</span><span class="ace_string">'subscribe'</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_storage ace_type">function</span> <span class="ace_paren ace_lparen">(</span><span class="ace_identifier">channel</span><span class="ace_paren ace_rparen">)</span> <span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">hanmeimei</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">publish</span><span class="ace_paren ace_lparen">(</span><span class="ace_string">'classroom'</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_string">'My name is Hanmeimei.'</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">hanmeimei</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">publish</span><span class="ace_paren ace_lparen">(</span><span class="ace_string">'classroom'</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_string">'What</span><span class="ace_constant ace_language ace_escape">\'</span><span class="ace_string">s your name?'</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_rparen">})</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">lilei</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">on</span><span class="ace_paren ace_lparen">(</span><span class="ace_string">'message'</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_storage ace_type">function</span> <span class="ace_paren ace_lparen">(</span><span class="ace_identifier">channel</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_identifier">message</span><span class="ace_paren ace_rparen">)</span> <span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_storage ace_type">console</span><span class="ace_punctuation ace_operator">.</span><span class="ace_support ace_function ace_firebug">log</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">message</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">count</span> <span class="ace_keyword ace_operator">+=</span> <span class="ace_constant ace_numeric">1</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_keyword">if</span> <span class="ace_paren ace_lparen">(</span><span class="ace_identifier">count</span> <span class="ace_keyword ace_operator">===</span> <span class="ace_constant ace_numeric">2</span><span class="ace_paren ace_rparen">)</span> <span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_storage ace_type">console</span><span class="ace_punctuation ace_operator">.</span><span class="ace_support ace_function ace_firebug">log</span><span class="ace_paren ace_lparen">(</span><span class="ace_string">'I am Lilei.'</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_identifier">lilei</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">unsubscribe</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_identifier">lilei</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">end</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_identifier">hanmeimei</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">end</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_paren ace_rparen">}</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_rparen">})</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">lilei</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">subscribe</span><span class="ace_paren ace_lparen">(</span><span class="ace_string">'classroom'</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span> <span class="ace_comment">// channel</span>
</div></div></div></pre>
<p>输出结果：</p>
<p><img src="resources/91129472CDCEFBD97420D35AC269B569.png" alt="pubsub.png" width="1074" height="100"></p>
<h2>7. 排序</h2>
<p><code>SORT</code> 用来给 list, set(或 zset) 排序。例如：</p>
<p><img src="resources/53F9E2FFDE28B94AF7973EBB592B5E33.png" alt="sort.png" width="1248" height="336"></p>
<p>完整的定义为：</p>
<blockquote>
<p>SORT key [BY pattern] [LIMIT offset count] [GET pattern [GET pattern ...]] [ASC|DESC] [ALPHA] [STORE destination]</p>
</blockquote>
<p>其中：</p>
<ul>
<li><code>DESC</code> 用来倒序排列</li>
<li><code>ALPHA</code> 用来进行字符串排序</li>
<li><code>LIMIT</code> 用来限制返回结果数</li>
</ul>
<p><code>SORT</code> 还可以实现类似关系数据库的外键查询，或跳过某元素等等更高级的功能。例如：</p>
<p><img src="resources/7DC203A5720C310786EA548890B81E95.png" alt="sort_more.png" width="1366" height="1106"></p>
<hr>
<p>@ssbunny 2015-12-03</p>
<p><img src="resources/9BDF5BC45B39A9BBFBF64D55FD48EC5B.png" alt="微信二维码_zhq_tiny.png" width="217" height="260"></p>
</div></div>
      <script>document.body.onkeyup = function(e) {
if (e.keyCode === 39) window.location.href = '[总结] JavaScript 中高级知识整理.html';
if (e.keyCode === 37) window.location.href = '[总结] 关于 JavaScript 数字的那些事.html';
}</script>
    </body>
    </html>
  