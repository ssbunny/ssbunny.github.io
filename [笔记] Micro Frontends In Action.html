
    <!DOCTYPE html>
    <html>
    <head>
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <!-- common.css -->
      <style>* {-webkit-tap-highlight-color: rgba(0,0,0,0);}html {-webkit-text-size-adjust: none;}body {font-family: -apple-system, Helvetica, Arial, sans-serif;margin: 0;padding: 20px;color: #333;word-wrap: break-word;}h1, h2, h3, h4, h5, h6 {line-height: 1.1;}img {max-width: 100% !important;height: auto;}blockquote {margin: 0;padding: 0 15px;color: #777;border-left: 4px solid #ddd;}hr {background-color: #ddd;border: 0;height: 1px;margin: 15px 0;}code {font-family: Menlo, Consolas, 'Ubuntu Mono', Monaco, 'source-code-pro', monospace;line-height: 1.4;margin: 0;padding: 0.2em 0;font-size: 90%;background-color: rgba(0,0,0,0.04);border-radius: 3px;}pre > code {margin: 0;padding: 0;font-size: 100%;word-break: normal;background: transparent;border: 0;}ol {list-style-type: decimal;}ol ol, ul ol {list-style-type: lower-latin;}ol ol ol, ul ol ol, ul ul ol, ol ul ol {list-style-type: lower-roman;}table {border-spacing: 0;border-collapse: collapse;margin-top: 0;margin-bottom: 16px;}table th {font-weight: bold;}table th, table td {padding: 6px 13px;border: 1px solid #ddd;}table tr {border-top: 1px solid #ccc;}table tr:nth-child(even) {background-color: #f8f8f8;}input[type="checkbox"] {cursor: default;margin-right: 0.5em;font-size: 13px;}.task-list-item {list-style-type: none;}.task-list-item+.task-list-item {margin-top: 3px;}.task-list-item input {float: left;margin: 0.3em 1em 0.25em -1.6em;vertical-align: middle;}#tag-field {margin: 8px 2px 10px;}#tag-field .tag {display: inline-block;background: #cadff3;border-radius: 4px;padding: 1px 8px;color: black;font-size: 12px;margin-right: 10px;line-height: 1.4;}</style>
      <!-- ace-static.css -->
      <style>.ace_static_highlight {white-space: pre-wrap;}.ace_static_highlight .ace_gutter {width: 2em;text-align: right;padding: 0 3px 0 0;margin-right: 3px;}.ace_static_highlight.ace_show_gutter > .ace_line {padding-left: 2.6em;}.ace_static_highlight .ace_line {position: relative;}.ace_static_highlight .ace_gutter-cell {-moz-user-select: -moz-none;-khtml-user-select: none;-webkit-user-select: none;user-select: none;top: 0;bottom: 0;left: 0;position: absolute;}.ace_static_highlight .ace_gutter-cell:before {content: counter(ace_line, decimal);counter-increment: ace_line;}.ace_static_highlight {counter-reset: ace_line;}</style>
      <style>.ace-chrome .ace_gutter {background: #ebebeb;color: #333;overflow : hidden;}.ace-chrome .ace_print-margin {width: 1px;background: #e8e8e8;}.ace-chrome {background-color: #FFFFFF;color: black;}.ace-chrome .ace_cursor {color: black;}.ace-chrome .ace_invisible {color: rgb(191, 191, 191);}.ace-chrome .ace_constant.ace_buildin {color: rgb(88, 72, 246);}.ace-chrome .ace_constant.ace_language {color: rgb(88, 92, 246);}.ace-chrome .ace_constant.ace_library {color: rgb(6, 150, 14);}.ace-chrome .ace_invalid {background-color: rgb(153, 0, 0);color: white;}.ace-chrome .ace_fold {}.ace-chrome .ace_support.ace_function {color: rgb(60, 76, 114);}.ace-chrome .ace_support.ace_constant {color: rgb(6, 150, 14);}.ace-chrome .ace_support.ace_type,.ace-chrome .ace_support.ace_class.ace-chrome .ace_support.ace_other {color: rgb(109, 121, 222);}.ace-chrome .ace_variable.ace_parameter {font-style:italic;color:#FD971F;}.ace-chrome .ace_keyword.ace_operator {color: rgb(104, 118, 135);}.ace-chrome .ace_comment {color: #236e24;}.ace-chrome .ace_comment.ace_doc {color: #236e24;}.ace-chrome .ace_comment.ace_doc.ace_tag {color: #236e24;}.ace-chrome .ace_constant.ace_numeric {color: rgb(0, 0, 205);}.ace-chrome .ace_variable {color: rgb(49, 132, 149);}.ace-chrome .ace_xml-pe {color: rgb(104, 104, 91);}.ace-chrome .ace_entity.ace_name.ace_function {color: #0000A2;}.ace-chrome .ace_heading {color: rgb(12, 7, 255);}.ace-chrome .ace_list {color:rgb(185, 6, 144);}.ace-chrome .ace_marker-layer .ace_selection {background: rgb(181, 213, 255);}.ace-chrome .ace_marker-layer .ace_step {background: rgb(252, 255, 0);}.ace-chrome .ace_marker-layer .ace_stack {background: rgb(164, 229, 101);}.ace-chrome .ace_marker-layer .ace_bracket {margin: -1px 0 0 -1px;border: 1px solid rgb(192, 192, 192);}.ace-chrome .ace_marker-layer .ace_active-line {background: rgba(0, 0, 0, 0.07);}.ace-chrome .ace_gutter-active-line {background-color : #dcdcdc;}.ace-chrome .ace_marker-layer .ace_selected-word {background: rgb(250, 250, 255);border: 1px solid rgb(200, 200, 250);}.ace-chrome .ace_storage,.ace-chrome .ace_keyword,.ace-chrome .ace_meta.ace_tag {color: rgb(147, 15, 128);}.ace-chrome .ace_string.ace_regex {color: rgb(255, 0, 0)}.ace-chrome .ace_string {color: #1A1AA6;}.ace-chrome .ace_entity.ace_other.ace_attribute-name {color: #994409;}.ace-chrome .ace_indent-guide {background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAACCAYAAACZgbYnAAAAE0lEQVQImWP4////f4bLly//BwAmVgd1/w11/gAAAABJRU5ErkJggg==") right repeat-y;}</style>
      <!-- export.css -->
      <style>
        body{margin:0 auto;max-width:800px;line-height:1.4}
        #nav{margin:5px 0 10px;font-size:15px}
        #titlearea{border-bottom:1px solid #ccc;font-size:17px;padding:10px 0;}
        #contentarea{font-size:15px;margin:16px 0}
        .cell{outline:0;min-height:20px;margin:5px 0;padding:5px 0;}
        .code-cell{font-family:Menlo,Consolas,'Ubuntu Mono',Monaco,'source-code-pro',monospace;font-size:12px;}
        .latex-cell{white-space:pre-wrap;}
      </style>
      <!-- User CSS -->
      <style> .text-cell {font-size: 15px;}.code-cell {font-size: 12px;}.markdown-cell {font-size: 15px;}.latex-cell {font-size: 15px;}</style>
    </head>
    <body>
      <div id="nav"><div>Next: <a href='[总结] 源码阅读_Redis 中的数据结构.html'>[总结] 源码阅读_Redis 中的数据结构</a>, Previous: <a href='[笔记] TypeScript 官方手册学习笔记.html'>[笔记] TypeScript 官方手册学习笔记</a>, Up: <a href='index.html'>Index</a></div></div>
      <div id="titlearea">
        <h2>[笔记] Micro Frontends In Action</h2>
      </div>
      <div id="contentarea"><div class="cell markdown-cell"><h1>1. 什么是微前端</h1>
<h2>1.1 The Big Picture</h2>
<p><img src="resources/6B461DCBF963CE6A4E491CD1B5C06A1E.jpg" alt="IMAGE" width="842" height="958"></p>
<p>前端融合(Frontend Integration)</p>
<h3>Cross-Functional Teams</h3>
<p><img src="resources/20B50D7D1CCE6D90A85CE825B2E580A6.jpg" alt="IMAGE" width="751" height="379"></p>
<ul>
<li>微服务型的架构，聚焦于技术或专业技能</li>
<li>微前端的架构，聚焦于用例或客户需求</li>
</ul>
<h3>The frontend</h3>
<p><img src="resources/2BFC6C7D6D0A108D0E99D465DDAECC0A.jpg" alt="IMAGE" width="704" height="293"></p>
<p>各团队创建自己的页面文件或片段</p>
<h4>片段</h4>
<p><img src="resources/F68EA11320608543751B341674B34B22.jpg" alt="IMAGE" width="725" height="331"></p>
<p>片段使用自己的状态或从页面中获取上下文信息。页面不需要知道片段的状态信息。</p>
<h3>Frontend integration</h3>
<p><img src="resources/333FA68BC8E41BD7DECB161DE6988F30.jpg" alt="IMAGE" width="775" height="573"></p>
<p>1）路由和页面变化：</p>
<ul>
<li>两种形式——HTML链接跳转、客户端路由</li>
<li>两种实现——Application shell，a meta-framework(single-spa)</li>
</ul>
<p>2）整合</p>
<ul>
<li>服务端整合: SSI、ESI、Tailor、Podium</li>
<li>客户端整合: iframes、Ajax、Web components</li>
</ul>
<p>3）应用间通讯</p>
<h3>公共话题</h3>
<p><img src="resources/2737A97B2446F6012187BD9F47ADEC25.jpg" alt="IMAGE" width="571" height="280"></p>
<h2>1.2 微前端解决的问题</h2>
<ul>
<li>
<p>快速开发</p>
<blockquote>
<p>Reducing waiting time between teams is micro frontends' primary goal.</p>
</blockquote>
</li>
<li>
<p>消除前端巨石<br>
<img src="resources/BF4AD73DB5EEFF0EE93BD10B558B8180.jpg" alt="IMAGE" width="490" height="295"></p>
<ul>
<li>独立部署</li>
<li>将失败的风险控制在更小的范围</li>
<li>更容易理解</li>
<li>代码更少，便于重构或重写</li>
<li>不共享状态，更可控</li>
</ul>
</li>
<li>
<p>持续更新</p>
<ul>
<li>遗留应用升级改造</li>
<li>更换应用技术框架（快速决策）</li>
</ul>
</li>
<li>
<p>独立应用的好处</p>
<ul>
<li>自容（各片段亦可独立地版本升级）</li>
<li>无共享架构（shared nothing architecture）</li>
</ul>
</li>
</ul>
<h2>1.3 微前端的负面作用</h2>
<ul>
<li><strong>冗余。</strong> 无共享带来代码、团队等冗余，如：
<ul>
<li>无法统一修复某类库的BUG</li>
<li>某团队提升了应用构建效率，其他团队无法直接获益</li>
</ul>
</li>
<li><strong>一致性差。</strong> 该架构需要数据独立性，因而需要使用event bus或其它反馈机制保持数据副本</li>
<li><strong>不匀称性(Heterogeneity)。</strong> 技术栈不一致，跨团队困难。可约定技术清单。</li>
<li><strong>更多前端代码。</strong> 微前端带来更多的前端代码，因此从一开始就需要考虑<strong>性能</strong>问题。</li>
</ul>
<h2>1.4 微前端的适用场景</h2>
<ul>
<li>中大型项目(两个批萨原则，10人内)</li>
<li>基于 web 或 webview</li>
<li>权衡效率提升和管理费用</li>
<li>不适用：人少沟通无障碍，业务不清或交叉，原生应用</li>
<li>谁在用：电商(欧图集团、亚马逊、宜家、Zalando)，工业(Spotify、SAP)</li>
</ul>
<h1>2. 第一个微前端项目</h1>
<ul>
<li>通过链接进行页面跳转</li>
<li>通过 iframe 进行页面整合</li>
</ul>
<h1>3. Ajax整合及服务端路由</h1>
<h2>3.1 通过Ajax整合</h2>
<p>实现方式：团队 A 提供 HTML 片段，团队 B 加载片段并插入到 DOM 中。</p>
<p>1）命名空间：</p>
<ul>
<li>使用约定的CSS前缀实现项目间的样式隔离。</li>
<li>JavaScript隔离：使用IIFE（立即执行函数表达式）。全局对象则声明为：</li>
</ul>
<pre><div class="ace-chrome"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_meta ace_tag ace_punctuation ace_tag-open ace_xml">&lt;</span><span class="ace_meta ace_tag ace_tag-name ace_xml">script</span><span class="ace_text ace_tag-whitespace ace_xml"> </span><span class="ace_entity ace_other ace_attribute-name ace_xml">data-inspire-state</span><span class="ace_text ace_tag-whitespace ace_xml"> </span><span class="ace_entity ace_other ace_attribute-name ace_xml">type</span><span class="ace_keyword ace_operator ace_attribute-equals ace_xml">=</span><span class="ace_string ace_attribute-value ace_xml">"application/json"</span><span class="ace_meta ace_tag ace_punctuation ace_tag-close ace_xml">&gt;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_quasi ace_start">{</span><span class="ace_string">"name"</span><span class="ace_punctuation ace_operator">:</span> <span class="ace_string">"Porsche"</span><span class="ace_paren ace_quasi ace_end">}</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_meta ace_tag ace_punctuation ace_end-tag-open ace_xml">&lt;/</span><span class="ace_meta ace_tag ace_tag-name ace_xml">script</span><span class="ace_meta ace_tag ace_punctuation ace_tag-close ace_xml">&gt;</span>
</div></div></div></pre>
<p>使用时</p>
<pre><div class="ace-chrome"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_lparen">(</span><span class="ace_storage ace_type">function</span> <span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span> <span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>  <span class="ace_storage ace_type">const</span> <span class="ace_identifier">stateContainer</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">fragment</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">querySelector</span><span class="ace_paren ace_lparen">(</span><span class="ace_string">"[data-inspire-state]"</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span> 
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>  <span class="ace_storage ace_type">const</span> <span class="ace_identifier">MY_STATE</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_variable ace_language">JSON</span><span class="ace_punctuation ace_operator">.</span><span class="ace_support ace_function">parse</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">stateContainer</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">innerHTML</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_rparen">})</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div></div></div></pre>
<p>仍有些命名空间问题要注意：Cookies，storage，CustomEvent等，可以使用前缀约定。</p>
<p>2）优点：</p>
<ul>
<li>常规的文档流</li>
<li>搜索友好</li>
<li>渐进式增强</li>
<li>弹性错误处理</li>
</ul>
<p>3）缺点：</p>
<ul>
<li>异步加载：页面抖动等问题（可通过服务端整合解决）</li>
<li>缺少隔离</li>
<li>必须产生服务端请求</li>
<li>缺少脚本生命周期（如，页面里的客户端JS执行时机）</li>
</ul>
<p>4）何时使用Ajax整合<br>
简单粗暴地实现方式，尤其适合标签在服务端生成的情况。不适合处理交互复杂和本地状态过多的场景。</p>
</div><div class="cell markdown-cell"><h2>3.2 使用Nginx实现服务端路由</h2>
<p><img src="resources/BAB9245359D9228FEAA93C14343B0ECF.jpg" alt="IMAGE" width="616" height="305"></p>
<p>实现方式：配置Nginx</p>
<p>1）命名空间：基于URL（按Team分组命名或在路由代理表中备注URL所属团队）<br>
2）只在无可替代时才引入中心组件（单点故障等问题）。其所有权要明确，一般由专门团队维护，而该水平团队通常是沟通障碍点。所以可以采用责任分工的方式：</p>
<p><img src="resources/7075D27B6451EEE97B832AEDE1BC9DC0.jpg" alt="IMAGE" width="643" height="328"></p>
<p>3）适用：需要在同一个域下显示。额外的好处：</p>
<ul>
<li>避免 CORS</li>
<li>通过 cookies 共享数据</li>
<li>更好的性能(只有一次DNS查找，SSL握手等)</li>
</ul>
<h1>4. 服务端整合</h1>
<p><img src="resources/29FAF9E638D682819B0C04A04A24A1E2.jpg" alt="IMAGE" width="629" height="407"></p>
<p>服务端整合一般会通过在浏览器和实际的应用服务器间增加一层服务来实现。好处是首次加载即可生成完整页面。</p>
<h2>4.1 基于 Nginx 的整合及服务器端包含</h2>
<blockquote>
<p>服务器端包含: Server-Side Includes (SSI)<br>
SSI 是一门古老的技术，可追溯到 19 世纪 90 年代。 当时人们用它来在静态页面中嵌入系统当前时间。该规范已很稳定，近年来并没有什么发展，其在各类主流服务器中的实现也很稳定。</p>
</blockquote>
<p><strong>SSI 工作原理</strong></p>
<p>SSI <code>include</code> 指令形如：</p>
<pre><div class="ace-chrome"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_xml">&lt;!--#include virtual="/url/to/include" --&gt;</span>
</div></div></div></pre>
<p>web 服务器将标签发给客户端以前，通过 URL 指定的内容替换该指令。</p>
<p>例如：</p>
<pre><div class="ace-chrome"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_meta ace_tag ace_punctuation ace_tag-open ace_xml">&lt;</span><span class="ace_meta ace_tag ace_tag-name ace_xml">aside</span><span class="ace_text ace_tag-whitespace ace_xml"> </span><span class="ace_entity ace_other ace_attribute-name ace_xml">class</span><span class="ace_keyword ace_operator ace_attribute-equals ace_xml">=</span><span class="ace_string ace_attribute-value ace_xml">"decide_recos"</span><span class="ace_meta ace_tag ace_punctuation ace_tag-close ace_xml">&gt;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_text ace_xml">  </span><span class="ace_comment ace_xml">&lt;!--#include virtual="/inspire/fragment/recommendations/porsche" --&gt;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_meta ace_tag ace_punctuation ace_end-tag-open ace_xml">&lt;/</span><span class="ace_meta ace_tag ace_tag-name ace_xml">aside</span><span class="ace_meta ace_tag ace_punctuation ace_tag-close ace_xml">&gt;</span>
</div></div></div></pre>
<p><img src="resources/21456A2F45DED6BF2D550B8B6999D404.jpg" alt="IMAGE" width="564" height="480"></p>
<ol>
<li>客户端请求 <code>/product/porsche</code></li>
<li>Nginx 根据 URL 前缀将请求转发至 Team Decide</li>
<li>Team Decide 生成产品页面，并用 SSI 指令包含待替换的推荐页面片段，发送至 Nginx</li>
<li>Nginx 解析响应体，找到 SSI，获取其中 URL 的内容</li>
<li>Nginx 向 Team Inspire 请求 URL 内容</li>
<li>Team Inspire 提供页面片段并返回</li>
<li>Nginx 用这些片段替换产品页面中的 SSI 注释</li>
<li>Nginx 将整合后的内容发送至浏览器</li>
</ol>
<p>Nginx 中打开 SSI 功能：</p>
<pre><div class="ace-chrome"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">server</span> <span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>  <span class="ace_identifier">listen</span> <span class="ace_constant ace_numeric">3000</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>  <span class="ace_identifier">ssi</span> <span class="ace_identifier">on</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>  ...
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_rparen">}</span>
</div></div></div></pre>
<p>更优的加载时间：</p>
<ul>
<li>节省了页面绑定的时间(网络因素)</li>
<li>节省了JS执行时间(终端配置性能因素)</li>
</ul>
<h2>4.2 处理不可靠的页面片段</h2>
<p>页面中某个片段可能加载时间过长甚至崩溃。服务端整合不可避免的问题是要等待所有片段加载完毕。</p>
<p>Nginx 可以配置超时时间：</p>
<pre><div class="ace-chrome"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment"># <span class="ace_cjk" style="width:NaNpx">注</span><span class="ace_cjk" style="width:NaNpx">意</span><span class="ace_cjk" style="width:NaNpx">是</span><span class="ace_cjk" style="width:NaNpx">配</span><span class="ace_cjk" style="width:NaNpx">置</span> upstream <span class="ace_cjk" style="width:NaNpx">超</span><span class="ace_cjk" style="width:NaNpx">时</span><span class="ace_cjk" style="width:NaNpx">时</span><span class="ace_cjk" style="width:NaNpx">间</span><span class="ace_cjk" style="width:NaNpx">，</span><span class="ace_cjk" style="width:NaNpx">而</span><span class="ace_cjk" style="width:NaNpx">不</span><span class="ace_cjk" style="width:NaNpx">是</span><span class="ace_cjk" style="width:NaNpx">请</span><span class="ace_cjk" style="width:NaNpx">求</span><span class="ace_cjk" style="width:NaNpx">超</span><span class="ace_cjk" style="width:NaNpx">时</span></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">location</span> <span class="ace_keyword ace_operator">/</span><span class="ace_identifier">inspire</span><span class="ace_keyword ace_operator">/</span> <span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>  <span class="ace_identifier">proxy_pass</span>  <span class="ace_identifier">http</span>:<span class="ace_keyword ace_operator">//</span><span class="ace_identifier">team_inspire</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>  <span class="ace_identifier">proxy_read_timeout</span> <span class="ace_constant ace_numeric">500</span><span class="ace_identifier">ms</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_rparen">}</span>
</div></div></div></pre>
<p>SSI 命令包含 <code>stub</code> 参数用以配置失效时的回退方案：</p>
<pre><div class="ace-chrome"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_meta ace_tag ace_punctuation ace_tag-open ace_xml">&lt;</span><span class="ace_meta ace_tag ace_tag-name ace_xml">aside</span><span class="ace_text ace_tag-whitespace ace_xml"> </span><span class="ace_entity ace_other ace_attribute-name ace_xml">class</span><span class="ace_keyword ace_operator ace_attribute-equals ace_xml">=</span><span class="ace_string ace_attribute-value ace_xml">"decide_recos"</span><span class="ace_meta ace_tag ace_punctuation ace_tag-close ace_xml">&gt;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_text ace_xml">  </span><span class="ace_comment ace_xml">&lt;!--# block name="reco_fallback" --&gt;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_text ace_xml">    </span><span class="ace_meta ace_tag ace_punctuation ace_tag-open ace_xml">&lt;</span><span class="ace_meta ace_tag ace_anchor ace_tag-name ace_xml">a</span><span class="ace_text ace_tag-whitespace ace_xml"> </span><span class="ace_entity ace_other ace_attribute-name ace_xml">href</span><span class="ace_keyword ace_operator ace_attribute-equals ace_xml">=</span><span class="ace_string ace_attribute-value ace_xml">"/recommendations/eicher"</span><span class="ace_meta ace_tag ace_punctuation ace_tag-close ace_xml">&gt;</span><span class="ace_text ace_xml">Show Recommendations</span><span class="ace_meta ace_tag ace_punctuation ace_end-tag-open ace_xml">&lt;/</span><span class="ace_meta ace_tag ace_anchor ace_tag-name ace_xml">a</span><span class="ace_meta ace_tag ace_punctuation ace_tag-close ace_xml">&gt;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_text ace_xml">  </span><span class="ace_comment ace_xml">&lt;!--# endblock --&gt;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_text ace_xml">  </span><span class="ace_comment ace_xml">&lt;!--#include</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_xml">    virtual="/inspire/fragment/recommendations/eicher"</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_xml">    stub="reco_fallback" --&gt;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_meta ace_tag ace_punctuation ace_end-tag-open ace_xml">&lt;/</span><span class="ace_meta ace_tag ace_tag-name ace_xml">aside</span><span class="ace_meta ace_tag ace_punctuation ace_tag-close ace_xml">&gt;</span>
</div></div></div></pre>
<p><strong>使用服务端整合时，一定要注意考虑 fallbacks 及 timeouts</strong></p>
<h2>4.3 性能问题</h2>
<p>1）并行加载</p>
<p><img src="resources/8EA3D02709A243450DFBAF1BD3A560C3.jpg" alt="IMAGE" width="693" height="280"></p>
<blockquote>
<p>The response time for the complete markup, also called <strong>time to first byte (TTFB)</strong>, is defined by the time it takes to generate the page markup and the time of the slowest fragment</p>
</blockquote>
<p>2）页面片段嵌套</p>
<p><img src="resources/9CD3D902DD4FA79B0153794FB46E91AC.jpg" alt="IMAGE" width="685" height="222"></p>
<p>3）延迟加载</p>
<p>合理选择 SSI 或 Ajax 。另外，两者很便于切换。</p>
<p>4）TTFB</p>
<p>三种方法：</p>
<p><img src="resources/11C405A482212D12F2B7B127DB24C605.jpg" alt="IMAGE" width="688" height="637"></p>
<h2>4.4 其它解决方案</h2>
<p>1）ESI</p>
<blockquote>
<p>Edge-Side Includes, or ESI, is a <a href="https://www.w3.org/TR/esi-lang/">specification</a> that defines a unified way of markup assembly.</p>
</blockquote>
<p>支持ESI的：Akamai（CDN）、Varnish、Squid、Mongrel</p>
<p>指令形如：</p>
<pre><div class="ace-chrome"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_meta ace_tag ace_punctuation ace_tag-open ace_xml">&lt;</span><span class="ace_meta ace_tag ace_tag-name ace_xml">esi:include</span><span class="ace_text ace_tag-whitespace ace_xml"> </span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_text ace_tag-whitespace ace_xml">  </span><span class="ace_entity ace_other ace_attribute-name ace_xml">src</span><span class="ace_keyword ace_operator ace_attribute-equals ace_xml">=</span><span class="ace_string ace_attribute-value ace_xml">"https://tractor.example/fragment"</span><span class="ace_text ace_tag-whitespace ace_xml"> </span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_text ace_tag-whitespace ace_xml">  </span><span class="ace_entity ace_other ace_attribute-name ace_xml">alt</span><span class="ace_keyword ace_operator ace_attribute-equals ace_xml">=</span><span class="ace_string ace_attribute-value ace_xml">"https://fallback.example/sorry"</span><span class="ace_text ace_tag-whitespace ace_xml"> </span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_text ace_tag-whitespace ace_xml">  </span><span class="ace_entity ace_other ace_attribute-name ace_xml">maxwait</span><span class="ace_keyword ace_operator ace_attribute-equals ace_xml">=</span><span class="ace_string ace_attribute-value ace_xml">"500"</span><span class="ace_text ace_tag-whitespace ace_xml"> </span><span class="ace_meta ace_tag ace_punctuation ace_tag-close ace_xml">/&gt;</span>
</div></div></div></pre>
<p>2）Zalando Tailor</p>
<blockquote>
<p>Tailor is a Node.js library that parses the page’s HTML for special fragment tags, fetches the ref- erenced content, and puts it into the page’s markup.</p>
</blockquote>
<p>指令形如：</p>
<pre><div class="ace-chrome"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_meta ace_tag ace_punctuation ace_tag-open ace_xml">&lt;</span><span class="ace_meta ace_tag ace_tag-name ace_xml">fragment</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_text ace_tag-whitespace ace_xml">  </span><span class="ace_entity ace_other ace_attribute-name ace_xml">src</span><span class="ace_keyword ace_operator ace_attribute-equals ace_xml">=</span><span class="ace_string ace_attribute-value ace_xml">"http://localhost:3002/recos"</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_text ace_tag-whitespace ace_xml">  </span><span class="ace_entity ace_other ace_attribute-name ace_xml">timeout</span><span class="ace_keyword ace_operator ace_attribute-equals ace_xml">=</span><span class="ace_string ace_attribute-value ace_xml">"500"</span><span class="ace_text ace_tag-whitespace ace_xml"> </span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_text ace_tag-whitespace ace_xml">  </span><span class="ace_entity ace_other ace_attribute-name ace_xml">fallback-src</span><span class="ace_keyword ace_operator ace_attribute-equals ace_xml">=</span><span class="ace_string ace_attribute-value ace_xml">"http://localhost:3002/recos/fallback"</span><span class="ace_text ace_tag-whitespace ace_xml"> </span><span class="ace_meta ace_tag ace_punctuation ace_tag-close ace_xml">/&gt;</span>
</div></div></div></pre>
<p>3）Podium</p>
<ul>
<li>layout library</li>
<li>podlet library</li>
</ul>
<p>4）适用性</p>
<p><img src="resources/6CC3FD264B6271B47B177314701BB6AA.jpg" alt="IMAGE" width="600" height="538"></p>
<p>没有银弹。SSI 和 ESI 均是很古老的技术，但这也正是其优点：极其稳定。</p>
<h2>4.5 服务端整合的优劣</h2>
<p>优点：</p>
<ul>
<li>提升首次加载性能</li>
<li>渐进式微前端，仍可用 Ajax</li>
<li>SSI/ESI 技术很成熟稳定</li>
<li>搜索引擎友好</li>
</ul>
<p>缺点：</p>
<ul>
<li>首字节加载时机晚</li>
<li>没有在浏览器中实现隔离，需要解决命名冲突等问题</li>
<li>本地开发变复杂，每个开发人员均需要web服务器提供 SSI 等功能</li>
</ul>
<p><img src="resources/65A52923026EFDAFD9FEC93A492F1054.jpg" alt="IMAGE" width="584" height="295"></p>
<h1>5. 客户端整合</h1>
<h2>5.1 使用 Web Components 包装微前端</h2>
<p>Web Components：</p>
<ul>
<li>Custom Elements</li>
<li>Shadow DOM</li>
<li>HTML Templates</li>
</ul>
<p>自定义元素：</p>
<pre><div class="ace-chrome"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_storage ace_type">const</span> <span class="ace_identifier">prices</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>  <span class="ace_identifier">porsche</span><span class="ace_punctuation ace_operator">:</span> <span class="ace_constant ace_numeric">66</span><span class="ace_punctuation ace_operator">,</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>  <span class="ace_identifier">fendt</span><span class="ace_punctuation ace_operator">:</span> <span class="ace_constant ace_numeric">54</span><span class="ace_punctuation ace_operator">,</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>  <span class="ace_identifier">eicher</span><span class="ace_punctuation ace_operator">:</span> <span class="ace_constant ace_numeric">58</span><span class="ace_punctuation ace_operator">,</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_rparen">}</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">class</span> <span class="ace_identifier">CheckoutBuy</span> <span class="ace_keyword">extends</span> <span class="ace_identifier">HTMLElement</span> <span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>  <span class="ace_identifier">connectedCallback</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span> <span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_storage ace_type">const</span> <span class="ace_identifier">sku</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_variable ace_language">this</span><span class="ace_punctuation ace_operator">.</span><span class="ace_support ace_function ace_dom">getAttribute</span><span class="ace_paren ace_lparen">(</span><span class="ace_string">"sku"</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_variable ace_language">this</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">innerHTML</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_string ace_quasi ace_start">`</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_string ace_quasi">  &lt;button type="button"&gt;buy for $</span><span class="ace_paren ace_quasi ace_start">${</span><span class="ace_identifier">prices</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">sku</span><span class="ace_paren ace_rparen">]</span><span class="ace_paren ace_quasi ace_end">}</span><span class="ace_string ace_quasi">&lt;/button&gt;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_string ace_quasi">    </span><span class="ace_string ace_quasi ace_end">`</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_keyword ace_operator">...</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>  <span class="ace_paren ace_rparen">}</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>  <span class="ace_identifier">disconnectedCallback</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span> <span class="ace_paren ace_lparen">{</span><span class="ace_keyword ace_operator">...</span><span class="ace_paren ace_rparen">}</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_rparen">}</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_variable ace_language">window</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">customElements</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">define</span><span class="ace_paren ace_lparen">(</span><span class="ace_string">"checkout-buy"</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_identifier">CheckoutBuy</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div></div></div></pre>
<pre><div class="ace-chrome"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_meta ace_tag ace_punctuation ace_tag-open ace_xml">&lt;</span><span class="ace_meta ace_tag ace_tag-name ace_xml">checkout-buy</span><span class="ace_text ace_tag-whitespace ace_xml"> </span><span class="ace_entity ace_other ace_attribute-name ace_xml">sku</span><span class="ace_keyword ace_operator ace_attribute-equals ace_xml">=</span><span class="ace_string ace_attribute-value ace_xml">"fendt"</span><span class="ace_meta ace_tag ace_punctuation ace_tag-close ace_xml">&gt;</span><span class="ace_meta ace_tag ace_punctuation ace_end-tag-open ace_xml">&lt;/</span><span class="ace_meta ace_tag ace_tag-name ace_xml">checkout-buy</span><span class="ace_meta ace_tag ace_punctuation ace_tag-close ace_xml">&gt;</span>
</div></div></div></pre>
<p>使用 Web Component 包装框架，如 Vuejs<br>
<a href="https://github.com/vuejs/vue-web-component-wrapper">https://github.com/vuejs/vue-web-component-wrapper</a></p>
<h2>5.2 使用 Shadow DOM 进行样式隔离</h2>
<p>在 HTML 元素上调用 <code>attachShadow()</code> ：</p>
<pre><div class="ace-chrome"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">class</span> <span class="ace_identifier">CheckoutBuy</span> <span class="ace_keyword">extends</span> <span class="ace_identifier">HTMLElement</span> <span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>  <span class="ace_identifier">connectedCallback</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span> <span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_storage ace_type">const</span> <span class="ace_identifier">sku</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_variable ace_language">this</span><span class="ace_punctuation ace_operator">.</span><span class="ace_support ace_function ace_dom">getAttribute</span><span class="ace_paren ace_lparen">(</span><span class="ace_string">"sku"</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_variable ace_language">this</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">attachShadow</span><span class="ace_paren ace_lparen">({</span> <span class="ace_identifier">mode</span><span class="ace_punctuation ace_operator">:</span> <span class="ace_string">"open"</span> <span class="ace_paren ace_rparen">})</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_comment">// <span class="ace_cjk" style="width:NaNpx">在</span> shadowRoot <span class="ace_cjk" style="width:NaNpx">上</span><span class="ace_cjk" style="width:NaNpx">插</span><span class="ace_cjk" style="width:NaNpx">入</span><span class="ace_cjk" style="width:NaNpx">内</span><span class="ace_cjk" style="width:NaNpx">容</span></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_variable ace_language">this</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">shadowRoot</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">innerHTML</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_string ace_quasi ace_start">`</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_string ace_quasi">  &lt;style&gt;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_string ace_quasi">    button {}</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_string ace_quasi">    button:hover {}</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_string ace_quasi">  &lt;/style&gt;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_string ace_quasi">  &lt;button type="button"&gt;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_string ace_quasi">    buy for $</span><span class="ace_paren ace_quasi ace_start">${</span><span class="ace_identifier">prices</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">sku</span><span class="ace_paren ace_rparen">]</span><span class="ace_paren ace_quasi ace_end">}</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_string ace_quasi">  &lt;/button&gt;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_string ace_quasi">    </span><span class="ace_string ace_quasi ace_end">`</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>  <span class="ace_paren ace_rparen">}</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_rparen">}</span>
</div></div></div></pre>
<p><img src="resources/3D96C9B122444B4A9DBC8D34E80F9A03.jpg" alt="IMAGE" width="681" height="499"></p>
<p><strong>利弊分析</strong></p>
<ul>
<li>利：
<ul>
<li>强隔离，不需要命名空间</li>
<li>阻止全局样式污染，特别适合处理遗留项目</li>
<li>减少对 css 工具的使用依赖</li>
<li>页面片段自容，不需额外的 css 文件</li>
</ul>
</li>
<li>弊：
<ul>
<li>低版本浏览器不支持</li>
<li>需要启用 JavaScript</li>
<li>不支持渐进增强或服务端渲染</li>
<li>不同 Shadow DOM 间难以共享样式</li>
<li>无法使用基于全局样式的库(Bootstrap等)</li>
</ul>
</li>
</ul>
<h2>5.3 使用 Web Component 进行整合的优缺点</h2>
<p>优点：</p>
<ul>
<li>标准化。API 相对稳定。</li>
<li>隔离性。自定义元素、影子DOM等。</li>
<li>标准化的生命周期方法，便于团队统一。</li>
</ul>
<p>缺点：</p>
<ul>
<li>需要启用 JavaScript</li>
<li>不支持服务端渲染</li>
<li>低版本浏览器不支持，Polyfill 困难</li>
</ul>
<p>适用性：交互性强的、app-like 的应用</p>
<p><img src="resources/8F40D539F745CE6FE91A2B52FE8ABC71.jpg" alt="IMAGE" width="605" height="311"></p>
<h1>6. 通信模式</h1>
<p><img src="resources/C7138A8C374687C807E05F678773700F.jpg" alt="IMAGE" width="681" height="337"></p>
<h2>6.1 UI 通信</h2>
<p>页面与页面间，通过 URL 和 Query String 。</p>
<p><strong>页面内，通常有三种：</strong></p>
<p><img src="resources/620E35D760488D25D030AA6A6C804FC3.jpg" alt="IMAGE" width="398" height="155"></p>
<p>父到子通信通过属性更新：</p>
<p><img src="resources/65D37E30FCEABD234AA7417C96D724BF.jpg" alt="IMAGE" width="472" height="157"></p>
<p>子到父通信通过自定义事件：</p>
<p><img src="resources/ACD85754C5486EC2CEE7CA387EE9BF45.jpg" alt="IMAGE" width="443" height="156"></p>
<p>子与子通信方式：</p>
<ul>
<li>直接通信（不建议）</li>
<li>通过父页面通信（联合使用父到子、子到父）</li>
<li>Event-Bus 或广播</li>
</ul>
<p><strong>Broadcast Channel API</strong></p>
<p>同源跨 window ，可在 iframe 和 tab 间传递消息。</p>
<p><strong>UI 通信适合于</strong>：</p>
<ul>
<li>轻量级数据交互</li>
<li>强烈的UI交互需求往往是边界不清的信号</li>
<li>使用事件时要注意微前端的异步加载问题</li>
</ul>
<h2>6.2 其它通信机制</h2>
<p>1）提供全局上下文信息：</p>
<ul>
<li>提供全局 JavaScript API, application shell）</li>
<li>一般由公共小组完成</li>
</ul>
<p>验证：OAuth 或 JWT 等</p>
<p><img src="resources/D8EE36696689D2E8AD5EC7AAFB93C11D.jpg" alt="IMAGE" width="741" height="192"></p>
<p>2）状态管理</p>
<p>微前端间状态共享，会导致各前端健壮性降低及组内通信的滥用。</p>
<p><img src="resources/A4E0368ADA095F59C470983D5DA9155B.jpg" alt="IMAGE" width="684" height="204"></p>
<p>3）前后端通信</p>
<p><img src="resources/72E94BCDFED32D809F5983A9C2847B21.jpg" alt="IMAGE" width="637" height="271"></p>
<p>4）数据复本</p>
<p>可以保证各团队的依赖独立性及系统健壮性</p>
<p><img src="resources/2C7E3F590D78721F0C9516D2083AE5DE.jpg" alt="IMAGE" width="541" height="199"></p>
<h1>7. 客户端路由及应用壳</h1>
<ul>
<li>Hard navigation，完整的页面加载，服务端跳转</li>
<li>Soft navigation，客户端渲染，客户端路由</li>
</ul>
<p><img src="resources/4A9AEB35EA7223CD0C7C88319BDF638D.jpg" alt="IMAGE" width="656" height="244"></p>
<p>通过应用壳提供一个共享层，完成统一的SPA。它类似前端代理层：</p>
<p><img src="resources/CD694AF675973D669485F46F9FDF72DD.jpg" alt="IMAGE" width="592" height="239"></p>
<h2>7.1 应用壳——平级路由</h2>
<p><img src="resources/1A849A0C4C53049FB3A8F705439494CB.jpg" alt="IMAGE" width="597" height="380"></p>
<p>app shell 的职责：</p>
<ol>
<li>提供共享 HTML 文档</li>
<li>映射 URL 到相应微前端团队</li>
<li>渲染匹配到的页面</li>
<li>初始化或销毁导航页面</li>
</ol>
<p>各微前端把页面通过组件的形式暴露给应用壳：</p>
<p><img src="resources/089ED2EE28F3BF62BAA52A1EA3096450.jpg" alt="IMAGE" width="495" height="189"></p>
<h2>7.1 应用壳——二级路由</h2>
<p>应用壳负责一级路由分发，二级路由则 交由各微前端处理：</p>
<p><img src="resources/4799DADB8E02D47EB6344BEB3A473F5C.jpg" alt="IMAGE" width="523" height="345"></p>
<hr>
<p>@ssbunny 2021-10</p>
<p><img src="resources/9BDF5BC45B39A9BBFBF64D55FD48EC5B.png" alt="微信二维码_zhq_tiny.png" width="217" height="260"></p>
</div></div>
      <script>document.body.onkeyup = function(e) {
if (e.keyCode === 39) window.location.href = '[总结] 源码阅读_Redis 中的数据结构.html';
if (e.keyCode === 37) window.location.href = '[笔记] TypeScript 官方手册学习笔记.html';
}</script>
    </body>
    </html>
  