<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.35">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="/images/favicon.ico"><title>Micro Frontends In Action | 兔子不咬人</title><meta name="description" content="我的个人空间">
    <link rel="modulepreload" href="/assets/app.1ea428fb.js"><link rel="modulepreload" href="/assets/Micro_Frontends_In_Action.html.4eb2464c.js"><link rel="modulepreload" href="/assets/Micro_Frontends_In_Action.html.949b1a06.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper.21dcd24c.js">
    <link rel="stylesheet" href="/assets/style.cdb4f165.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header ref_key="navbar" class="navbar"><div class="toggle-sidebar-button" title="切换侧边栏" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><img class="logo" src="/images/home_bug.svg" alt="兔子不咬人"><span class="site-name can-hide">兔子不咬人</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/notes" class="router-link-active" aria-label="技术文章"><!--[--><!--]--> 技术文章 <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="实验室"><span class="title">实验室</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="实验室"><span class="title">实验室</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/lab/css_layout_flexbox" class="" aria-label="CSS Flex 布局"><!--[--><!--]--> CSS Flex 布局 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lab/css_layout_grid" class="" aria-label="CSS Grid 布局"><!--[--><!--]--> CSS Grid 布局 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lab/web-demo" class="" aria-label="Web 特效演示"><!--[--><!--]--> Web 特效演示 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="常用链接"><span class="title">常用链接</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="常用链接"><span class="title">常用链接</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a class="external-link" href="https://pythontutor.com/visualize.html#mode=edit" rel="noopener noreferrer" target="_blank" aria-label="代码执行过程可视化"><!--[--><!--]--> 代码执行过程可视化 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://latex.codecogs.com/" rel="noopener noreferrer" target="_blank" aria-label="latex 公式编辑器"><!--[--><!--]--> latex 公式编辑器 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://asciiflow.com/#/" rel="noopener noreferrer" target="_blank" aria-label="ascii 流程图"><!--[--><!--]--> ascii 流程图 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="http://patorjk.com/software/taag" rel="noopener noreferrer" target="_blank" aria-label="ascii art 生成"><!--[--><!--]--> ascii art 生成 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/ssbunny" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="切换夜间模式"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/notes" class="router-link-active" aria-label="技术文章"><!--[--><!--]--> 技术文章 <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="实验室"><span class="title">实验室</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="实验室"><span class="title">实验室</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/lab/css_layout_flexbox" class="" aria-label="CSS Flex 布局"><!--[--><!--]--> CSS Flex 布局 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lab/css_layout_grid" class="" aria-label="CSS Grid 布局"><!--[--><!--]--> CSS Grid 布局 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lab/web-demo" class="" aria-label="Web 特效演示"><!--[--><!--]--> Web 特效演示 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="常用链接"><span class="title">常用链接</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="常用链接"><span class="title">常用链接</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a class="external-link" href="https://pythontutor.com/visualize.html#mode=edit" rel="noopener noreferrer" target="_blank" aria-label="代码执行过程可视化"><!--[--><!--]--> 代码执行过程可视化 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://latex.codecogs.com/" rel="noopener noreferrer" target="_blank" aria-label="latex 公式编辑器"><!--[--><!--]--> latex 公式编辑器 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://asciiflow.com/#/" rel="noopener noreferrer" target="_blank" aria-label="ascii 流程图"><!--[--><!--]--> ascii 流程图 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="http://patorjk.com/software/taag" rel="noopener noreferrer" target="_blank" aria-label="ascii art 生成"><!--[--><!--]--> ascii art 生成 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/ssbunny" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">Micro Frontends In Action <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/notes/migrate/Micro_Frontends_In_Action.html#_1-什么是微前端" class="router-link-active router-link-exact-active sidebar-item" aria-label="1. 什么是微前端"><!--[--><!--]--> 1. 什么是微前端 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/notes/migrate/Micro_Frontends_In_Action.html#_1-1-the-big-picture" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.1 The Big Picture"><!--[--><!--]--> 1.1 The Big Picture <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/notes/migrate/Micro_Frontends_In_Action.html#_1-2-微前端解决的问题" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.2 微前端解决的问题"><!--[--><!--]--> 1.2 微前端解决的问题 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/notes/migrate/Micro_Frontends_In_Action.html#_1-3-微前端的负面作用" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.3 微前端的负面作用"><!--[--><!--]--> 1.3 微前端的负面作用 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/notes/migrate/Micro_Frontends_In_Action.html#_1-4-微前端的适用场景" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.4 微前端的适用场景"><!--[--><!--]--> 1.4 微前端的适用场景 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/notes/migrate/Micro_Frontends_In_Action.html#_2-第一个微前端项目" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.第一个微前端项目"><!--[--><!--]--> 2.第一个微前端项目 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/notes/migrate/Micro_Frontends_In_Action.html#_3-ajax整合及服务端路由" class="router-link-active router-link-exact-active sidebar-item" aria-label="3. Ajax整合及服务端路由"><!--[--><!--]--> 3. Ajax整合及服务端路由 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/notes/migrate/Micro_Frontends_In_Action.html#_3-1-通过ajax整合" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.1 通过Ajax整合"><!--[--><!--]--> 3.1 通过Ajax整合 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/notes/migrate/Micro_Frontends_In_Action.html#_3-2-使用nginx实现服务端路由" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.2 使用Nginx实现服务端路由"><!--[--><!--]--> 3.2 使用Nginx实现服务端路由 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/notes/migrate/Micro_Frontends_In_Action.html#_4-服务端整合" class="router-link-active router-link-exact-active sidebar-item" aria-label="4. 服务端整合"><!--[--><!--]--> 4. 服务端整合 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/notes/migrate/Micro_Frontends_In_Action.html#_4-1-基于-nginx-的整合及服务器端包含" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.1 基于 Nginx 的整合及服务器端包含"><!--[--><!--]--> 4.1 基于 Nginx 的整合及服务器端包含 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/notes/migrate/Micro_Frontends_In_Action.html#_4-2-处理不可靠的页面片段" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.2 处理不可靠的页面片段"><!--[--><!--]--> 4.2 处理不可靠的页面片段 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/notes/migrate/Micro_Frontends_In_Action.html#_4-3-性能问题" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.3 性能问题"><!--[--><!--]--> 4.3 性能问题 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/notes/migrate/Micro_Frontends_In_Action.html#_4-4-其它解决方案" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.4 其它解决方案"><!--[--><!--]--> 4.4 其它解决方案 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/notes/migrate/Micro_Frontends_In_Action.html#_4-5-服务端整合的优劣" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.5 服务端整合的优劣"><!--[--><!--]--> 4.5 服务端整合的优劣 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/notes/migrate/Micro_Frontends_In_Action.html#_5-客户端整合" class="router-link-active router-link-exact-active sidebar-item" aria-label="5. 客户端整合"><!--[--><!--]--> 5. 客户端整合 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/notes/migrate/Micro_Frontends_In_Action.html#_5-1-使用-web-components-包装微前端" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.1 使用 Web Components 包装微前端"><!--[--><!--]--> 5.1 使用 Web Components 包装微前端 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/notes/migrate/Micro_Frontends_In_Action.html#_5-2-使用-shadow-dom-进行样式隔离" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.2 使用 Shadow DOM 进行样式隔离"><!--[--><!--]--> 5.2 使用 Shadow DOM 进行样式隔离 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/notes/migrate/Micro_Frontends_In_Action.html#_5-3-使用-web-component-进行整合的优缺点" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.3 使用 Web Component 进行整合的优缺点"><!--[--><!--]--> 5.3 使用 Web Component 进行整合的优缺点 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/notes/migrate/Micro_Frontends_In_Action.html#_6-通信模式" class="router-link-active router-link-exact-active sidebar-item" aria-label="6. 通信模式"><!--[--><!--]--> 6. 通信模式 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/notes/migrate/Micro_Frontends_In_Action.html#_6-1-ui-通信" class="router-link-active router-link-exact-active sidebar-item" aria-label="6.1 UI 通信"><!--[--><!--]--> 6.1 UI 通信 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/notes/migrate/Micro_Frontends_In_Action.html#_6-2-其它通信机制" class="router-link-active router-link-exact-active sidebar-item" aria-label="6.2 其它通信机制"><!--[--><!--]--> 6.2 其它通信机制 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/notes/migrate/Micro_Frontends_In_Action.html#_7-客户端路由及应用壳" class="router-link-active router-link-exact-active sidebar-item" aria-label="7. 客户端路由及应用壳"><!--[--><!--]--> 7. 客户端路由及应用壳 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/notes/migrate/Micro_Frontends_In_Action.html#_7-1-应用壳——平级路由" class="router-link-active router-link-exact-active sidebar-item" aria-label="7.1 应用壳——平级路由"><!--[--><!--]--> 7.1 应用壳——平级路由 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/notes/migrate/Micro_Frontends_In_Action.html#_7-2-应用壳——二级路由" class="router-link-active router-link-exact-active sidebar-item" aria-label="7.2 应用壳——二级路由"><!--[--><!--]--> 7.2 应用壳——二级路由 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="micro-frontends-in-action" tabindex="-1"><a class="header-anchor" href="#micro-frontends-in-action" aria-hidden="true">#</a> Micro Frontends In Action</h1><h2 id="_1-什么是微前端" tabindex="-1"><a class="header-anchor" href="#_1-什么是微前端" aria-hidden="true">#</a> 1. 什么是微前端</h2><h3 id="_1-1-the-big-picture" tabindex="-1"><a class="header-anchor" href="#_1-1-the-big-picture" aria-hidden="true">#</a> 1.1 The Big Picture</h3><p><img src="/assets/6B461DCBF963CE6A4E491CD1B5C06A1E.375d74f0.jpg" alt="IMAGE"></p><p>前端融合(Frontend Integration)</p><h4 id="cross-functional-teams" tabindex="-1"><a class="header-anchor" href="#cross-functional-teams" aria-hidden="true">#</a> Cross-Functional Teams</h4><p><img src="/assets/20B50D7D1CCE6D90A85CE825B2E580A6.3e08da0b.jpg" alt="IMAGE"></p><ul><li>微服务型的架构，聚焦于技术或专业技能</li><li>微前端的架构，聚焦于用例或客户需求</li></ul><h4 id="the-frontend" tabindex="-1"><a class="header-anchor" href="#the-frontend" aria-hidden="true">#</a> The frontend</h4><p><img src="/assets/2BFC6C7D6D0A108D0E99D465DDAECC0A.167d0044.jpg" alt="IMAGE"></p><p>各团队创建自己的页面文件或片段</p><h5 id="片段" tabindex="-1"><a class="header-anchor" href="#片段" aria-hidden="true">#</a> 片段</h5><p><img src="/assets/F68EA11320608543751B341674B34B22.e268ac75.jpg" alt="IMAGE"></p><p>片段使用自己的状态或从页面中获取上下文信息。页面不需要知道片段的状态信息。</p><h4 id="frontend-integration" tabindex="-1"><a class="header-anchor" href="#frontend-integration" aria-hidden="true">#</a> Frontend integration</h4><p><img src="/assets/333FA68BC8E41BD7DECB161DE6988F30.1078accf.jpg" alt="IMAGE"></p><p>1）路由和页面变化：</p><ul><li>两种形式——HTML链接跳转、客户端路由</li><li>两种实现——Application shell，a meta-framework(single-spa)</li></ul><p>2）整合</p><ul><li>服务端整合: SSI、ESI、Tailor、Podium</li><li>客户端整合: iframes、Ajax、Web components</li></ul><p>3）应用间通讯</p><h4 id="公共话题" tabindex="-1"><a class="header-anchor" href="#公共话题" aria-hidden="true">#</a> 公共话题</h4><p><img src="/assets/2737A97B2446F6012187BD9F47ADEC25.af26b721.jpg" alt="IMAGE"></p><h3 id="_1-2-微前端解决的问题" tabindex="-1"><a class="header-anchor" href="#_1-2-微前端解决的问题" aria-hidden="true">#</a> 1.2 微前端解决的问题</h3><ul><li><p>快速开发</p><blockquote><p>Reducing waiting time between teams is micro frontends&#39; primary goal.</p></blockquote></li><li><p>消除前端巨石 <img src="/assets/BF4AD73DB5EEFF0EE93BD10B558B8180.dfc100e4.jpg" alt="IMAGE"></p><ul><li>独立部署</li><li>将失败的风险控制在更小的范围</li><li>更容易理解</li><li>代码更少，便于重构或重写</li><li>不共享状态，更可控</li></ul></li><li><p>持续更新</p><ul><li>遗留应用升级改造</li><li>更换应用技术框架（快速决策）</li></ul></li><li><p>独立应用的好处</p><ul><li>自容（各片段亦可独立地版本升级）</li><li>无共享架构（shared nothing architecture）</li></ul></li></ul><h3 id="_1-3-微前端的负面作用" tabindex="-1"><a class="header-anchor" href="#_1-3-微前端的负面作用" aria-hidden="true">#</a> 1.3 微前端的负面作用</h3><ul><li><strong>冗余。</strong> 无共享带来代码、团队等冗余，如： <ul><li>无法统一修复某类库的BUG</li><li>某团队提升了应用构建效率，其他团队无法直接获益</li></ul></li><li><strong>一致性差。</strong> 该架构需要数据独立性，因而需要使用event bus或其它反馈机制保持数据副本</li><li><strong>不匀称性(Heterogeneity)。</strong> 技术栈不一致，跨团队困难。可约定技术清单。</li><li><strong>更多前端代码。</strong> 微前端带来更多的前端代码，因此从一开始就需要考虑<strong>性能</strong>问题。</li></ul><h3 id="_1-4-微前端的适用场景" tabindex="-1"><a class="header-anchor" href="#_1-4-微前端的适用场景" aria-hidden="true">#</a> 1.4 微前端的适用场景</h3><ul><li>中大型项目(两个批萨原则，10人内)</li><li>基于 web 或 webview</li><li>权衡效率提升和管理费用</li><li>不适用：人少沟通无障碍，业务不清或交叉，原生应用</li><li>谁在用：电商(欧图集团、亚马逊、宜家、Zalando)，工业(Spotify、SAP)</li></ul><h2 id="_2-第一个微前端项目" tabindex="-1"><a class="header-anchor" href="#_2-第一个微前端项目" aria-hidden="true">#</a> 2.第一个微前端项目</h2><ul><li>通过链接进行页面跳转</li><li>通过 iframe 进行页面整合</li></ul><h2 id="_3-ajax整合及服务端路由" tabindex="-1"><a class="header-anchor" href="#_3-ajax整合及服务端路由" aria-hidden="true">#</a> 3. Ajax整合及服务端路由</h2><h3 id="_3-1-通过ajax整合" tabindex="-1"><a class="header-anchor" href="#_3-1-通过ajax整合" aria-hidden="true">#</a> 3.1 通过Ajax整合</h3><p>实现方式：团队 A 提供 HTML 片段，团队 B 加载片段并插入到 DOM 中。</p><p>1）命名空间：</p><ul><li>使用约定的CSS前缀实现项目间的样式隔离。</li><li>JavaScript隔离：使用IIFE（立即执行函数表达式）。全局对象则声明为：</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">&lt;</span>script data<span class="token operator">-</span>inspire<span class="token operator">-</span>state type<span class="token operator">=</span><span class="token string">&quot;application/json&quot;</span><span class="token operator">&gt;</span>
<span class="token punctuation">{</span><span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Porsche&quot;</span><span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>使用时</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> stateContainer <span class="token operator">=</span> fragment<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;[data-inspire-state]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token keyword">const</span> <span class="token constant">MY_STATE</span> <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>stateContainer<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>仍有些命名空间问题要注意：Cookies，storage，CustomEvent等，可以使用前缀约定。</p><p>2）优点：</p><ul><li>常规的文档流</li><li>搜索友好</li><li>渐进式增强</li><li>弹性错误处理</li></ul><p>3）缺点：</p><ul><li>异步加载：页面抖动等问题（可通过服务端整合解决）</li><li>缺少隔离</li><li>必须产生服务端请求</li><li>缺少脚本生命周期（如，页面里的客户端JS执行时机）</li></ul><p>4）何时使用Ajax整合 简单粗暴地实现方式，尤其适合标签在服务端生成的情况。不适合处理交互复杂和本地状态过多的场景。</p><h3 id="_3-2-使用nginx实现服务端路由" tabindex="-1"><a class="header-anchor" href="#_3-2-使用nginx实现服务端路由" aria-hidden="true">#</a> 3.2 使用Nginx实现服务端路由</h3><p><img src="/assets/BAB9245359D9228FEAA93C14343B0ECF.087c0817.jpg" alt="IMAGE"></p><p>实现方式：配置Nginx</p><p>1）命名空间：基于URL（按Team分组命名或在路由代理表中备注URL所属团队） 2）只在无可替代时才引入中心组件（单点故障等问题）。其所有权要明确，一般由专门团队维护，而该水平团队通常是沟通障碍点。所以可以采用责任分工的方式：</p><p><img src="/assets/7075D27B6451EEE97B832AEDE1BC9DC0.3252a147.jpg" alt="IMAGE"></p><p>3）适用：需要在同一个域下显示。额外的好处：</p><ul><li>避免 CORS</li><li>通过 cookies 共享数据</li><li>更好的性能(只有一次DNS查找，SSL握手等)</li></ul><h2 id="_4-服务端整合" tabindex="-1"><a class="header-anchor" href="#_4-服务端整合" aria-hidden="true">#</a> 4. 服务端整合</h2><p><img src="/assets/29FAF9E638D682819B0C04A04A24A1E2.5f5449fb.jpg" alt="IMAGE"></p><p>服务端整合一般会通过在浏览器和实际的应用服务器间增加一层服务来实现。好处是首次加载即可生成完整页面。</p><h3 id="_4-1-基于-nginx-的整合及服务器端包含" tabindex="-1"><a class="header-anchor" href="#_4-1-基于-nginx-的整合及服务器端包含" aria-hidden="true">#</a> 4.1 基于 Nginx 的整合及服务器端包含</h3><blockquote><p>服务器端包含: Server-Side Includes (SSI) SSI 是一门古老的技术，可追溯到 19 世纪 90 年代。 当时人们用它来在静态页面中嵌入系统当前时间。该规范已很稳定，近年来并没有什么发展，其在各类主流服务器中的实现也很稳定。</p></blockquote><p><strong>SSI 工作原理</strong></p><p>SSI <code>include</code> 指令形如：</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!--#include virtual=&quot;/url/to/include&quot; --&gt;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>web 服务器将标签发给客户端以前，通过 URL 指定的内容替换该指令。</p><p>例如：</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>aside</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>decide_recos<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!--#include virtual=&quot;/inspire/fragment/recommendations/porsche&quot; --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>aside</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><img src="/assets/21456A2F45DED6BF2D550B8B6999D404.b052967d.jpg" alt="IMAGE"></p><ol><li>客户端请求 <code>/product/porsche</code></li><li>Nginx 根据 URL 前缀将请求转发至 Team Decide</li><li>Team Decide 生成产品页面，并用 SSI 指令包含待替换的推荐页面片段，发送至 Nginx</li><li>Nginx 解析响应体，找到 SSI，获取其中 URL 的内容</li><li>Nginx 向 Team Inspire 请求 URL 内容</li><li>Team Inspire 提供页面片段并返回</li><li>Nginx 用这些片段替换产品页面中的 SSI 注释</li><li>Nginx 将整合后的内容发送至浏览器</li></ol><p>Nginx 中打开 SSI 功能：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>server <span class="token punctuation">{</span>
  listen <span class="token number">3000</span><span class="token punctuation">;</span>
  ssi on<span class="token punctuation">;</span>
  <span class="token punctuation">..</span>.
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>更优的加载时间：</p><ul><li>节省了页面绑定的时间(网络因素)</li><li>节省了JS执行时间(终端配置性能因素)</li></ul><h3 id="_4-2-处理不可靠的页面片段" tabindex="-1"><a class="header-anchor" href="#_4-2-处理不可靠的页面片段" aria-hidden="true">#</a> 4.2 处理不可靠的页面片段</h3><p>页面中某个片段可能加载时间过长甚至崩溃。服务端整合不可避免的问题是要等待所有片段加载完毕。</p><p>Nginx 可以配置超时时间：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 注意是配置 upstream 超时时间，而不是请求超时</span>
location /inspire/ <span class="token punctuation">{</span>
  proxy_pass  http://team_inspire<span class="token punctuation">;</span>
  proxy_read_timeout 500ms<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>SSI 命令包含 <code>stub</code> 参数用以配置失效时的回退方案：</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>aside</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>decide_recos<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!--# block name=&quot;reco_fallback&quot; --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/recommendations/eicher<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Show Recommendations<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!--# endblock --&gt;</span>
  <span class="token comment">&lt;!--#include
    virtual=&quot;/inspire/fragment/recommendations/eicher&quot;
    stub=&quot;reco_fallback&quot; --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>aside</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>使用服务端整合时，一定要注意考虑 fallbacks 及 timeouts</strong></p><h3 id="_4-3-性能问题" tabindex="-1"><a class="header-anchor" href="#_4-3-性能问题" aria-hidden="true">#</a> 4.3 性能问题</h3><p>1）并行加载</p><p><img src="/assets/8EA3D02709A243450DFBAF1BD3A560C3.550e6654.jpg" alt="IMAGE"></p><blockquote><p>The response time for the complete markup, also called <strong>time to first byte (TTFB)</strong>, is defined by the time it takes to generate the page markup and the time of the slowest fragment</p></blockquote><p>2）页面片段嵌套</p><p><img src="/assets/9CD3D902DD4FA79B0153794FB46E91AC.e2bccd5c.jpg" alt="IMAGE"></p><p>3）延迟加载</p><p>合理选择 SSI 或 Ajax 。另外，两者很便于切换。</p><p>4）TTFB</p><p>三种方法：</p><p><img src="/assets/11C405A482212D12F2B7B127DB24C605.4a27ebce.jpg" alt="IMAGE"></p><h3 id="_4-4-其它解决方案" tabindex="-1"><a class="header-anchor" href="#_4-4-其它解决方案" aria-hidden="true">#</a> 4.4 其它解决方案</h3><p>1）ESI</p><blockquote><p>Edge-Side Includes, or ESI, is a <a href="https://www.w3.org/TR/esi-lang/" target="_blank" rel="noopener noreferrer">specification<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a> that defines a unified way of markup assembly.</p></blockquote><p>支持ESI的：Akamai（CDN）、Varnish、Squid、Mongrel</p><p>指令形如：</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">esi:</span>include</span> 
  <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://tractor.example/fragment<span class="token punctuation">&quot;</span></span> 
  <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://fallback.example/sorry<span class="token punctuation">&quot;</span></span> 
  <span class="token attr-name">maxwait</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>500<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>2）Zalando Tailor</p><blockquote><p>Tailor is a Node.js library that parses the page’s HTML for special fragment tags, fetches the ref- erenced content, and puts it into the page’s markup.</p></blockquote><p>指令形如：</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fragment</span>
  <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://localhost:3002/recos<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">timeout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>500<span class="token punctuation">&quot;</span></span> 
  <span class="token attr-name">fallback-src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://localhost:3002/recos/fallback<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>3）Podium</p><ul><li>layout library</li><li>podlet library</li></ul><p>4）适用性</p><p><img src="/assets/6CC3FD264B6271B47B177314701BB6AA.f8dfc694.jpg" alt="IMAGE"></p><p>没有银弹。SSI 和 ESI 均是很古老的技术，但这也正是其优点：极其稳定。</p><h3 id="_4-5-服务端整合的优劣" tabindex="-1"><a class="header-anchor" href="#_4-5-服务端整合的优劣" aria-hidden="true">#</a> 4.5 服务端整合的优劣</h3><p>优点：</p><ul><li>提升首次加载性能</li><li>渐进式微前端，仍可用 Ajax</li><li>SSI/ESI 技术很成熟稳定</li><li>搜索引擎友好</li></ul><p>缺点：</p><ul><li>首字节加载时机晚</li><li>没有在浏览器中实现隔离，需要解决命名冲突等问题</li><li>本地开发变复杂，每个开发人员均需要web服务器提供 SSI 等功能</li></ul><p><img src="/assets/65A52923026EFDAFD9FEC93A492F1054.7a9dcdc5.jpg" alt="IMAGE"></p><h2 id="_5-客户端整合" tabindex="-1"><a class="header-anchor" href="#_5-客户端整合" aria-hidden="true">#</a> 5. 客户端整合</h2><h3 id="_5-1-使用-web-components-包装微前端" tabindex="-1"><a class="header-anchor" href="#_5-1-使用-web-components-包装微前端" aria-hidden="true">#</a> 5.1 使用 Web Components 包装微前端</h3><p>Web Components：</p><ul><li>Custom Elements</li><li>Shadow DOM</li><li>HTML Templates</li></ul><p>自定义元素：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> prices <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">porsche</span><span class="token operator">:</span> <span class="token number">66</span><span class="token punctuation">,</span>
  <span class="token literal-property property">fendt</span><span class="token operator">:</span> <span class="token number">54</span><span class="token punctuation">,</span>
  <span class="token literal-property property">eicher</span><span class="token operator">:</span> <span class="token number">58</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">CheckoutBuy</span> <span class="token keyword">extends</span> <span class="token class-name">HTMLElement</span> <span class="token punctuation">{</span>
  <span class="token function">connectedCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> sku <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;sku&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
      &lt;button type=&quot;button&quot;&gt;buy for $</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>prices<span class="token punctuation">[</span>sku<span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/button&gt;
    </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token operator">...</span>
  <span class="token punctuation">}</span>
  <span class="token function">disconnectedCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
window<span class="token punctuation">.</span>customElements<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">&quot;checkout-buy&quot;</span><span class="token punctuation">,</span> CheckoutBuy<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>checkout-buy</span> <span class="token attr-name">sku</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fendt<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>checkout-buy</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>使用 Web Component 包装框架，如 Vuejs https://github.com/vuejs/vue-web-component-wrapper</p><h3 id="_5-2-使用-shadow-dom-进行样式隔离" tabindex="-1"><a class="header-anchor" href="#_5-2-使用-shadow-dom-进行样式隔离" aria-hidden="true">#</a> 5.2 使用 Shadow DOM 进行样式隔离</h3><p>在 HTML 元素上调用 <code>attachShadow()</code> ：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">CheckoutBuy</span> <span class="token keyword">extends</span> <span class="token class-name">HTMLElement</span> <span class="token punctuation">{</span>
  <span class="token function">connectedCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> sku <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;sku&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">attachShadow</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&quot;open&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 在 shadowRoot 上插入内容</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>shadowRoot<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
      &lt;style&gt;
        button {}
        button:hover {}
      &lt;/style&gt;
      &lt;button type=&quot;button&quot;&gt;
        buy for $</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>prices<span class="token punctuation">[</span>sku<span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
      &lt;/button&gt;
    </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><img src="/assets/3D96C9B122444B4A9DBC8D34E80F9A03.2fd204a7.jpg" alt="IMAGE"></p><p><strong>利弊分析</strong></p><ul><li>利： <ul><li>强隔离，不需要命名空间</li><li>阻止全局样式污染，特别适合处理遗留项目</li><li>减少对 css 工具的使用依赖</li><li>页面片段自容，不需额外的 css 文件</li></ul></li><li>弊： <ul><li>低版本浏览器不支持</li><li>需要启用 JavaScript</li><li>不支持渐进增强或服务端渲染</li><li>不同 Shadow DOM 间难以共享样式</li><li>无法使用基于全局样式的库(Bootstrap等)</li></ul></li></ul><h3 id="_5-3-使用-web-component-进行整合的优缺点" tabindex="-1"><a class="header-anchor" href="#_5-3-使用-web-component-进行整合的优缺点" aria-hidden="true">#</a> 5.3 使用 Web Component 进行整合的优缺点</h3><p>优点：</p><ul><li>标准化。API 相对稳定。</li><li>隔离性。自定义元素、影子DOM等。</li><li>标准化的生命周期方法，便于团队统一。</li></ul><p>缺点：</p><ul><li>需要启用 JavaScript</li><li>不支持服务端渲染</li><li>低版本浏览器不支持，Polyfill 困难</li></ul><p>适用性：交互性强的、app-like 的应用</p><p><img src="/assets/8F40D539F745CE6FE91A2B52FE8ABC71.90aff23a.jpg" alt="IMAGE"></p><h2 id="_6-通信模式" tabindex="-1"><a class="header-anchor" href="#_6-通信模式" aria-hidden="true">#</a> 6. 通信模式</h2><p><img src="/assets/C7138A8C374687C807E05F678773700F.6bf312c7.jpg" alt="IMAGE"></p><h3 id="_6-1-ui-通信" tabindex="-1"><a class="header-anchor" href="#_6-1-ui-通信" aria-hidden="true">#</a> 6.1 UI 通信</h3><p>页面与页面间，通过 URL 和 Query String 。</p><p><strong>页面内，通常有三种：</strong></p><p><img src="/assets/620E35D760488D25D030AA6A6C804FC3.9c50a4e9.jpg" alt="IMAGE"></p><p>父到子通信通过属性更新：</p><p><img src="/assets/65D37E30FCEABD234AA7417C96D724BF.11ec6e7f.jpg" alt="IMAGE"></p><p>子到父通信通过自定义事件：</p><p><img src="/assets/ACD85754C5486EC2CEE7CA387EE9BF45.a7343831.jpg" alt="IMAGE"></p><p>子与子通信方式：</p><ul><li>直接通信（不建议）</li><li>通过父页面通信（联合使用父到子、子到父）</li><li>Event-Bus 或广播</li></ul><p><strong>Broadcast Channel API</strong></p><p>同源跨 window ，可在 iframe 和 tab 间传递消息。</p><p><strong>UI 通信适合于</strong>：</p><ul><li>轻量级数据交互</li><li>强烈的UI交互需求往往是边界不清的信号</li><li>使用事件时要注意微前端的异步加载问题</li></ul><h3 id="_6-2-其它通信机制" tabindex="-1"><a class="header-anchor" href="#_6-2-其它通信机制" aria-hidden="true">#</a> 6.2 其它通信机制</h3><p>1）提供全局上下文信息：</p><ul><li>提供全局 JavaScript API, application shell）</li><li>一般由公共小组完成</li></ul><p>验证：OAuth 或 JWT 等</p><p><img src="/assets/D8EE36696689D2E8AD5EC7AAFB93C11D.61f1ad85.jpg" alt="IMAGE"></p><p>2）状态管理</p><p>微前端间状态共享，会导致各前端健壮性降低及组内通信的滥用。</p><p><img src="/assets/A4E0368ADA095F59C470983D5DA9155B.5d0d11f1.jpg" alt="IMAGE"></p><p>3）前后端通信</p><p><img src="/assets/72E94BCDFED32D809F5983A9C2847B21.ac46e7d8.jpg" alt="IMAGE"></p><p>4）数据复本</p><p>可以保证各团队的依赖独立性及系统健壮性</p><p><img src="/assets/2C7E3F590D78721F0C9516D2083AE5DE.46ba6b96.jpg" alt="IMAGE"></p><h2 id="_7-客户端路由及应用壳" tabindex="-1"><a class="header-anchor" href="#_7-客户端路由及应用壳" aria-hidden="true">#</a> 7. 客户端路由及应用壳</h2><ul><li>Hard navigation，完整的页面加载，服务端跳转</li><li>Soft navigation，客户端渲染，客户端路由</li></ul><p><img src="/assets/4A9AEB35EA7223CD0C7C88319BDF638D.87991cea.jpg" alt="IMAGE"></p><p>通过应用壳提供一个共享层，完成统一的SPA。它类似前端代理层：</p><p><img src="/assets/CD694AF675973D669485F46F9FDF72DD.549def76.jpg" alt="IMAGE"></p><h3 id="_7-1-应用壳——平级路由" tabindex="-1"><a class="header-anchor" href="#_7-1-应用壳——平级路由" aria-hidden="true">#</a> 7.1 应用壳——平级路由</h3><p><img src="/assets/1A849A0C4C53049FB3A8F705439494CB.b483b417.jpg" alt="IMAGE"></p><p>app shell 的职责：</p><ol><li>提供共享 HTML 文档</li><li>映射 URL 到相应微前端团队</li><li>渲染匹配到的页面</li><li>初始化或销毁导航页面</li></ol><p>各微前端把页面通过组件的形式暴露给应用壳：</p><p><img src="/assets/089ED2EE28F3BF62BAA52A1EA3096450.cff68147.jpg" alt="IMAGE"></p><h3 id="_7-2-应用壳——二级路由" tabindex="-1"><a class="header-anchor" href="#_7-2-应用壳——二级路由" aria-hidden="true">#</a> 7.2 应用壳——二级路由</h3><p>应用壳负责一级路由分发，二级路由则 交由各微前端处理：</p><p><img src="/assets/4799DADB8E02D47EB6344BEB3A473F5C.08883bae.jpg" alt="IMAGE"></p><hr><p>@ssbunny 2021-10</p><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: qqbunny@yeah.net">ssbunny</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app.1ea428fb.js" defer></script>
  </body>
</html>
